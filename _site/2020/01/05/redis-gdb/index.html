<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>gdb 调试 redis</title>
    <meta name="description" content="可以通过 gdb / vscode 调试 redis 源码，理解 redis 工作流程。">

    <link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_8v3czwksspqlg14i.css">
    <link rel="stylesheet" href="/css/main.css ">
    <link rel="canonical" href="http://localhost:4000/2020/01/05/redis-gdb/">
    <link rel="alternate" type="application/rss+xml" title=" " href="http://localhost:4000/feed.xml ">


    <script>
    // 百度统计代码
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?c0731ae90724efee0af2c272a7bd1594";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>


    <script>
    // google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-158372315-1', 'auto');
      ga('send', 'pageview');

    </script>



</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand"> </a>
        <small> </small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/">
                    
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>

                
                    
                    <li>
                        
                        <a href="/archive/">
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/category/">
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                
                    
                
                    
                    <li>
                        
                        <a href="/tag/">
                        
                            <i class="fa fa-tags"></i>Tags
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/collection/">
                        
                            <i class="fa fa-bookmark"></i>Collections
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/about/">
                        
                            <i class="fa fa-heart"></i>About
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" post>
    <div class="left">
        <h1>gdb 调试 redis</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2020-01-05
            </div>

            <div class="label-card">
                <i class="fa fa-user"></i>wenfh2020
                
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#redis" title="Category: redis" rel="category">redis</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

            <div class="label-card">
            
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <!--a href="/tag/#redis" title="Tag: redis" rel="tag">redis</a-->
        <a href="/tag/#redis" title="Tag: redis" rel="tag">redis</a>&nbsp;
    
        <!--a href="/tag/#gdb" title="Tag: gdb" rel="tag">gdb</a-->
        <a href="/tag/#gdb" title="Tag: gdb" rel="tag">gdb</a>&nbsp;
    
        <!--a href="/tag/#vscode" title="Tag: vscode" rel="tag">vscode</a-->
        <a href="/tag/#vscode" title="Tag: vscode" rel="tag">vscode</a>
    
  

</span>

            </div>

        </div>
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        <p>可以通过 gdb / vscode 调试 redis 源码，理解 redis 工作流程。</p>

<p><img src="https://raw.githubusercontent.com/wenfh2020/imgs_for_blog/master/md20200215134208.png" alt="调试" /></p>

<ul id="markdown-toc">
  <li><a href="#视频" id="markdown-toc-视频">视频</a></li>
  <li><a href="#gdb-常用命令" id="markdown-toc-gdb-常用命令">gdb 常用命令</a></li>
  <li><a href="#安装编译-redis" id="markdown-toc-安装编译-redis">安装编译 redis</a></li>
  <li><a href="#gdb-调试流程" id="markdown-toc-gdb-调试流程">gdb 调试流程</a></li>
  <li><a href="#vscode-调试流程" id="markdown-toc-vscode-调试流程">vscode 调试流程</a>    <ul>
      <li><a href="#启动-vscode" id="markdown-toc-启动-vscode">启动 vscode</a></li>
      <li><a href="#vscode-项目配置" id="markdown-toc-vscode-项目配置">vscode 项目配置</a></li>
      <li><a href="#vscode-调试" id="markdown-toc-vscode-调试">vscode 调试</a></li>
    </ul>
  </li>
  <li><a href="#参考" id="markdown-toc-参考">参考</a></li>
</ul>

<hr />

<h2 id="视频">视频</h2>

<ul>
  <li>bilibili  (<a href="https://www.bilibili.com/video/av83070640">Debug Redis in VsCode with Gdb</a>)</li>
  <li>youtube (<a href="https://www.youtube.com/watch?v=QltK3vV5Slw">Debug Redis in VsCode with Gdb</a> )</li>
  <li>对应操作文档： <a href="https://github.com/wenfh2020/youtobe/blob/master/redis-debug.md">github</a></li>
</ul>

<hr />

<h2 id="gdb-常用命令">gdb 常用命令</h2>

<p>详细文档通过命令查看：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>man gdb
</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th>命令</th>
      <th>操作</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>r</td>
      <td>运行调试</td>
    </tr>
    <tr>
      <td>n</td>
      <td>下一步</td>
    </tr>
    <tr>
      <td>c</td>
      <td>继续运行</td>
    </tr>
    <tr>
      <td>ctrl + c</td>
      <td>中断信号</td>
    </tr>
    <tr>
      <td>c/continue</td>
      <td>中断后继续运行</td>
    </tr>
    <tr>
      <td>s</td>
      <td>进入一个函数</td>
    </tr>
    <tr>
      <td>finish</td>
      <td>退出函数</td>
    </tr>
    <tr>
      <td>l</td>
      <td>列出代码行</td>
    </tr>
    <tr>
      <td>b</td>
      <td>断点<br />显示断点列表 info b<br />删除断点 delete number<br />清除断点 clear</td>
    </tr>
    <tr>
      <td>n</td>
      <td>下一步</td>
    </tr>
    <tr>
      <td>until</td>
      <td>跳至行号<br />until <number></number></td>
    </tr>
    <tr>
      <td>p</td>
      <td>打印<br />打印数组信息 p *array@len<br />p/x 按十六进制格式显示变量</td>
    </tr>
    <tr>
      <td>bt/backtrace</td>
      <td>堆栈bt &lt;-n&gt;<br />-n表一个负整数，表示只打印栈底下n层的栈信息。</td>
    </tr>
    <tr>
      <td>f/frame</td>
      <td>进入指定堆栈层<br /> f <number></number></td>
    </tr>
    <tr>
      <td>thread apply all bt</td>
      <td>显示线程所有堆栈</td>
    </tr>
    <tr>
      <td>attach</td>
      <td>绑定进程调试<br />attach &lt;-p pid&gt;</td>
    </tr>
    <tr>
      <td>detach</td>
      <td>取消绑定调试进程</td>
    </tr>
    <tr>
      <td>disassemble</td>
      <td>看二进制数据<br />disassemble <func></func></td>
    </tr>
    <tr>
      <td>x</td>
      <td>查看内存</td>
    </tr>
    <tr>
      <td>focus</td>
      <td>显示源码界面</td>
    </tr>
    <tr>
      <td>display</td>
      <td>显示变量</td>
    </tr>
    <tr>
      <td>info registers</td>
      <td>查看寄存器</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="安装编译-redis">安装编译 redis</h2>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget http://download.redis.io/releases/redis-3.2.8.tar.gz
<span class="nb">tar </span>xzf redis-3.2.8.tar.gz
<span class="nb">cd </span>redis-3.2.8

</code></pre></div></div>
<p>更新 Makefile，修改相应编译项</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim src/Makefile
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># OPTIMIZATION?=-O2</span>
OPTIMIZATION?<span class="o">=</span><span class="nt">-O0</span>
<span class="c"># REDIS_LD=$(QUIET_LINK)$(CC) $(FINAL_LDFLAGS)</span>
<span class="nv">REDIS_LD</span><span class="o">=</span><span class="si">$(</span>QUIET_LINK<span class="si">)$(</span>CC<span class="si">)</span> <span class="si">$(</span>FINAL_LDFLAGS<span class="si">)</span> <span class="si">$(</span>OPTIMIZATION<span class="si">)</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make clean<span class="p">;</span> make
</code></pre></div></div>

<hr />

<h2 id="gdb-调试流程">gdb 调试流程</h2>

<table>
  <thead>
    <tr>
      <th>步骤</th>
      <th>命令</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>sudo gdb –args ./src/redis-server redis.conf</td>
      <td>启动调试</td>
    </tr>
    <tr>
      <td>2</td>
      <td>r</td>
      <td>运行程序</td>
    </tr>
    <tr>
      <td>3</td>
      <td>ctrl + c（键盘操作）</td>
      <td>中断程序</td>
    </tr>
    <tr>
      <td>4</td>
      <td>b dict.c:dictAdd</td>
      <td>对应代码下断点</td>
    </tr>
    <tr>
      <td>5</td>
      <td>c</td>
      <td>继续运行程序</td>
    </tr>
    <tr>
      <td>6</td>
      <td>redis-cli<br />set k5 v5</td>
      <td>启动 client 连接redis-server测试（redis 默认端口 6379）</td>
    </tr>
    <tr>
      <td>7</td>
      <td>focus</td>
      <td>进入源码窗口调试</td>
    </tr>
    <tr>
      <td>8</td>
      <td>bt</td>
      <td>程序堆栈(查看接口调用流程)</td>
    </tr>
    <tr>
      <td>9</td>
      <td>f 0</td>
      <td>进入堆栈第 0 层</td>
    </tr>
    <tr>
      <td>10</td>
      <td>n</td>
      <td>单步调试</td>
    </tr>
  </tbody>
</table>

<p><img src="https://raw.githubusercontent.com/wenfh2020/imgs_for_blog/master/md20200215134838.png" alt="命令窗口调试" /></p>

<p><img src="https://raw.githubusercontent.com/wenfh2020/imgs_for_blog/master/md20200215134612.png" alt="源码窗口调试" /></p>

<h2 id="vscode-调试流程">vscode 调试流程</h2>

<h3 id="启动-vscode">启动 vscode</h3>

<p>因为 gdb 在 macOS 下需要 sudo 提升权限，vscode 配置貌似没有这个选项设置。所以只能用下面这个命令启动 vscode 项目</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># redis 源码本地目录</span>
<span class="nb">cd</span> ~/src/other/redis-3.2.8

<span class="c">#  vscode 打开 redis 源码目录</span>
<span class="nb">sudo </span>code <span class="nt">--user-data-dir</span><span class="o">=</span><span class="s2">"~/.vscode-root"</span> <span class="nb">.</span>
</code></pre></div></div>

<h3 id="vscode-项目配置">vscode 项目配置</h3>

<ul>
  <li>launch.json</li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.2.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"configurations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gcc build and debug active file"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cppdbg"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="s2">"launch"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"program"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceFolder}/src/redis-server"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"redis.conf"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"stopAtEntry"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nl">"cwd"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceFolder}"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"environment"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
            </span><span class="nl">"externalConsole"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"MIMode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gdb"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"preLaunchTask"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>tasks.json</li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.0.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"tasks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/usr/bin/make"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="vscode-调试">vscode 调试</h3>

<p><img src="https://raw.githubusercontent.com/wenfh2020/imgs_for_blog/master/md20200215134945.png" alt="调试" /></p>

<hr />

<h2 id="参考">参考</h2>

<ul>
  <li><a href="https://blog.csdn.net/men_wen/article/details/75220102">gdb 调试工具 — 使用方法浅析</a></li>
  <li><a href="https://blog.csdn.net/suxinpingtao51/article/details/12072559">Linux中gdb 查看core堆栈信息</a></li>
  <li><a href="https://www.jianshu.com/p/692d1cd27e9b">linux上用gdb调试redis源码</a></li>
</ul>

        </article>
        <hr>

        
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <h2 id="similar_posts">Similar Posts</h2>
                        <ul>
                        
                        <li class="relatedPost">
                            <a href="/2020/02/05/redis-obj/">[redis 源码走读] 对象(redisObject)
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2020/02/04/redis-inset/">[redis 源码走读] 整数集合(inset)
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2020/02/03/redis-skiplist/">[redis 源码走读] 跳跃表(skiplist)
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2020/01/30/redis-ziplist/">[redis 源码走读] 压缩列表(ziplist)
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <li class="relatedPost">
                            <a href="/2020/01/21/redis-list/">[redis 源码走读] 链表
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
            
        
        
            </ul>
        

        <div class="post-recent">
    <div class="pre">
        
        <p><strong>上一篇</strong> <a href="/2019/11/17/redis-learn/">redis 学习的思考</a></p>
        
    </div>
    <div class="nex">

        
        <p><strong>下一篇</strong> <a href="/2020/01/12/redis-dict/">[redis 源码走读] 字典(dict)</a></p>
        
    </div>
</div>


        <h2 id="comments">Comments</h2>
        


<div id="disqus_thread"></div>
<script>
    /**
     * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */

    var disqus_config = function() {
        this.page.url = 'http://localhost:4000/2020/01/05/redis-gdb/'; // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://localhost:4000/2020/01/05/redis-gdb/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };

    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document,
            s = d.createElement('script');

        s.src = '//wenfh2020.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>




    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">

            <!-- Content -->
            <div class="side content">
                <div>
                    Content
                </div>
                <ul id="content-side" class="content-ul">
                    
                    <li><a href="#similar_posts">Similar Posts</a></li>
                    
                    <li><a href="#comments">Comments</a></li>
                </ul>
            </div>
            <!-- 其他div框放到这里 -->
            <!-- <div class="side">bbbb</div> -->
        </div>
    </div>
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a:not([id])')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/pageContent.js " charset="utf-8"></script>


    <footer class="site-footer">


    <div class="wrapper">

        <p class="description">
            
        </p>
        <p class="contact">
            Contact me at: 
            <a href="https://github.com/wenfh2020" title="GitHub"><i class="fa fa-github"
                    aria-hidden="true"></i></a>  
            <a href="mailto:wenfh2020@126.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>
             
            <a href="http://weibo.com/wenfh2020" title="Weibo"><i class="fa fa-weibo"
                    aria-hidden="true"></i></a>  
            <a href="https://www.zhihu.com/people/wenfh2020" title="Zhihu"><i
                    class="iconfont icon-daoruzhihu"></i></a>   
             
        </p>
        <p>
            本站总访问量<span id="busuanzi_value_site_pv"></span>次，本站访客数<span
                id="busuanzi_value_site_uv"></span>人次，本文总阅读量<span id="busuanzi_value_page_pv"></span>次
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">Github
                    Pages</a>.
            </span>
            <span>
                Theme designed by <a href="https://github.com/wenfh2020">wenfh2020</a>.
            </span>
        </p>
    </div>
</footer>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <div class="back-to-top">
    <a href="#top" data-scroll>
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/smooth-scroll.min.js " charset="utf-8"></script>
    <script type="text/javascript">
      smoothScroll.init({
        speed: 500, // Integer. How fast to complete the scroll in milliseconds
        easing: 'easeInOutCubic', // Easing pattern to use
        offset: 20, // Integer. How far to offset the scrolling anchor location in pixels
      });
    </script>
    <!-- <script src=" /js/scroll.min.js " charset="utf-8"></script> -->
  </body>

</html>
