---
layout: post
title:  "ç”¨ gdb è°ƒè¯• redis"
categories: redis
tags: redis gdb vscode
author: wenfh2020
---

å¯ä»¥é€šè¿‡ gdb / vscode è°ƒè¯• redis æºç ï¼Œç†è§£ redis å·¥ä½œæµç¨‹ã€‚



* content
{:toc}

---

## 1. è§†é¢‘

* bilibili  ([Debug Redis in VsCode with Gdb](https://www.bilibili.com/video/av83070640))
* youtube ([Debug Redis in VsCode with Gdb](https://www.youtube.com/watch?v=QltK3vV5Slw) )
* å¯¹åº”æ“ä½œæ–‡æ¡£ï¼š [github](https://github.com/wenfh2020/youtobe/blob/master/redis-debug.md)

---

## 2. gdb å¸¸ç”¨å‘½ä»¤

è¯¦ç»†æ–‡æ¡£é€šè¿‡å‘½ä»¤ `man gdb` æŸ¥çœ‹ã€‚

| å‘½ä»¤                | æ“ä½œ                                                                       |
| ------------------- | -------------------------------------------------------------------------- |
| r                   | è¿è¡Œè°ƒè¯•                                                                   |
| n                   | ä¸‹ä¸€æ­¥                                                                     |
| c                   | ç»§ç»­è¿è¡Œ                                                                   |
| ctrl + c            | ä¸­æ–­ä¿¡å·                                                                   |
| c/continue          | ä¸­æ–­åç»§ç»­è¿è¡Œ                                                             |
| s                   | è¿›å…¥ä¸€ä¸ªå‡½æ•°                                                               |
| finish              | é€€å‡ºå‡½æ•°                                                                   |
| l                   | åˆ—å‡ºä»£ç è¡Œ                                                                 |
| b                   | æ–­ç‚¹<br/>æ˜¾ç¤ºæ–­ç‚¹åˆ—è¡¨ info b<br/>åˆ é™¤æ–­ç‚¹ delete number<br/>æ¸…é™¤æ–­ç‚¹ clear |
| until               | è·³è‡³è¡Œå·<br/>until <number>                                                |
| p                   | æ‰“å°<br/>æ‰“å°æ•°ç»„ä¿¡æ¯ p *array@len<br/>p/x æŒ‰åå…­è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡          |
| bt/backtrace        | å †æ ˆbt <-n><br/>-nè¡¨ä¸€ä¸ªè´Ÿæ•´æ•°ï¼Œè¡¨ç¤ºåªæ‰“å°æ ˆåº•ä¸‹nå±‚çš„æ ˆä¿¡æ¯ã€‚              |
| f/frame             | è¿›å…¥æŒ‡å®šå †æ ˆå±‚<br/> f <number>                                             |
| thread apply all bt | æ˜¾ç¤ºçº¿ç¨‹æ‰€æœ‰å †æ ˆ                                                           |
| attach              | ç»‘å®šè¿›ç¨‹è°ƒè¯•<br/>attach -p   \<pid>                                        |
| detach              | å–æ¶ˆç»‘å®šè°ƒè¯•è¿›ç¨‹                                                           |
| disassemble         | çœ‹äºŒè¿›åˆ¶æ•°æ®<br/>disassemble <func>                                        |
| x                   | æŸ¥çœ‹å†…å­˜                                                                   |
| focus               | æ˜¾ç¤ºæºç ç•Œé¢                                                               |
| display             | æ˜¾ç¤ºå˜é‡                                                                   |
| info registers      | æŸ¥çœ‹å¯„å­˜å™¨                                                                 |

---

## 3. å®‰è£…ç¼–è¯‘ redis

```shell
wget http://download.redis.io/releases/redis-3.2.8.tar.gz
tar xzf redis-3.2.8.tar.gz
cd redis-3.2.8
```

æ›´æ–° Makefileï¼Œä¿®æ”¹ç›¸åº”ç¼–è¯‘é¡¹

```shell
vim src/Makefile
```

```shell
# OPTIMIZATION?=-O2
OPTIMIZATION?=-O0
# REDIS_LD=$(QUIET_LINK)$(CC) $(FINAL_LDFLAGS)
REDIS_LD=$(QUIET_LINK)$(CC) $(FINAL_LDFLAGS) $(OPTIMIZATION)
```

```shell
make clean; make
```

---

## 4. gdb è°ƒè¯•æµç¨‹

| æ­¥éª¤ | å‘½ä»¤                                          | æè¿°                                                    |
| ---- | --------------------------------------------- | ------------------------------------------------------- |
| 1    | sudo gdb --args ./src/redis-server redis.conf | å¯åŠ¨è°ƒè¯•                                                |
| 2    | r                                             | è¿è¡Œç¨‹åº                                                |
| 3    | ctrl + cï¼ˆé”®ç›˜æ“ä½œï¼‰                          | ä¸­æ–­ç¨‹åº                                                |
| 4    | b dict.c:dictAdd                              | å¯¹åº”ä»£ç ä¸‹æ–­ç‚¹                                          |
| 5    | c                                             | ç»§ç»­è¿è¡Œç¨‹åº                                            |
| 6    | redis-cli<br/>set k5 v5                       | å¯åŠ¨ client è¿æ¥redis-serveræµ‹è¯•ï¼ˆredis é»˜è®¤ç«¯å£ 6379ï¼‰ |
| 7    | focus                                         | è¿›å…¥æºç çª—å£è°ƒè¯•                                        |
| 8    | bt                                            | ç¨‹åºå †æ ˆ(æŸ¥çœ‹æ¥å£è°ƒç”¨æµç¨‹)                              |
| 9    | f 0                                           | è¿›å…¥å †æ ˆç¬¬ 0 å±‚                                         |
| 10   | n                                             | å•æ­¥è°ƒè¯•                                                |

![å‘½ä»¤çª—å£è°ƒè¯•](/images/2020-02-20-16-51-07.png){: data-action="zoom"}

![æºç çª—å£è°ƒè¯•](/images/2020-02-20-16-51-21.png){: data-action="zoom"}

## 5. vscode è°ƒè¯•æµç¨‹

### 5.1. å¯åŠ¨ vscode

å› ä¸º gdb åœ¨ macOS ä¸‹éœ€è¦ sudo æå‡æƒé™ï¼Œvscode é…ç½®è²Œä¼¼æ²¡æœ‰è¿™ä¸ªé€‰é¡¹è®¾ç½®ã€‚æ‰€ä»¥åªèƒ½ç”¨ä¸‹é¢è¿™ä¸ªå‘½ä»¤å¯åŠ¨ vscode é¡¹ç›®

```shell
# redis æºç æœ¬åœ°ç›®å½•
cd ~/src/other/redis-3.2.8

#  vscode æ‰“å¼€ redis æºç ç›®å½•
sudo code --user-data-dir="~/.vscode-root" .
```

### 5.2. vscode é¡¹ç›®é…ç½®

* launch.json

```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "gcc build and debug active file",
            "type": "cppdbg",
            "request": "launch",
            "program": "${workspaceFolder}/src/redis-server",
            "args": [
                "redis.conf"
            ],
            "stopAtEntry": true,
            "cwd": "${workspaceFolder}",
            "environment": [],
            "externalConsole": false,
            "MIMode": "gdb",
            "preLaunchTask": "shell"
        }
    ]
}
```

* tasks.json

```json
{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "shell",
            "type": "shell",
            "command": "/usr/bin/make"
        }
    ]
}
```

### 5.3. vscode è°ƒè¯•

![è°ƒè¯•](/images/2020-02-20-16-51-48.png){: data-action="zoom"}

---

## 6. å‚è€ƒ

* [gdb è°ƒè¯•å·¥å…· --- ä½¿ç”¨æ–¹æ³•æµ…æ](https://blog.csdn.net/men_wen/article/details/75220102)
* [Linuxä¸­gdb æŸ¥çœ‹coreå †æ ˆä¿¡æ¯](https://blog.csdn.net/suxinpingtao51/article/details/12072559)
* [linuxä¸Šç”¨gdbè°ƒè¯•redisæºç ](https://www.jianshu.com/p/692d1cd27e9b)

---

> ğŸ”¥ æ–‡ç« æ¥æºï¼š[ã€Šç”¨ gdb è°ƒè¯• redisã€‹](https://wenfh2020.com/2020/01/05/redis-gdb/)
>
> ğŸ‘ å¤§å®¶è§‰å¾—æ–‡ç« å¯¹ä½ æœ‰äº›ä½œç”¨ï¼ å¦‚æœæƒ³ <font color=green>èµèµ</font>ï¼Œå¯ä»¥ç”¨å¾®ä¿¡æ‰«æä¸‹é¢çš„äºŒç»´ç ï¼Œæ„Ÿè°¢!
<div align=center><img src="/images/2020-08-06-15-49-47.png" width="120"/></div>
