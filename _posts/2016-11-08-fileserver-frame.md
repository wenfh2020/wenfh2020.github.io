---
layout: post
title:  "文件服务器架构逻辑"
categories: redis
tags: redis expire
author: wenfh2020
--- 

客户端 <--> 文件服务器代理 <--> FDFS。



* content
{:toc}

---

## 概述

文件服务器主要是 FDFS（FastDFS）文件存储系统的一个代理。

* 支持 HTTP 协议。
* 支持上传，下载基本功能，支持秒传文件（文件曾经上传到服务器，不用再次上传）。
* 支持本地文件缓存，针对热点文件上传下载。

---

在上传文件前，客户端需要计算其 `md5` 指纹，客户端根据指纹与服务器交互，如果指纹已在服务器存库，那说明该文件曾经上传过，无需重复上传，也就是秒传。因为文件内容不保存文件名，所以文件服务器也只保存文件内容，并不保存文件名，文件名和文件目录由其它业务服务进行维护。文件服务器只保存文件数据，与其它系统没有任何业务逻辑关系。

* 只支持小文件的上传下载，续传等功能。
* 不支持文件加密，文件目录等逻辑功能。
* 文件信息需要建立与业务信息建立关系，请客户端上传或者下载成功文件后，再向相关的业务服务器添加关联的存储记录。

---

## 架构

![文件服务器架构](/images/2020-02-24-09-14-59.png)

| 对象        | 描述                                                 |
| :---------- | :--------------------------------------------------- |
| client      | 客户端                                               |
| lvs         | 服务器集群系统负载均衡                               |
| file server | 文件服务器                                           |
| file        | 存储磁盘文件                                         |
| mysql       | 文件服务器记录文件信息以及 fdfs 对应的文件索引信息。 |
| fdfs        | FastDFS是一个开源的轻量级分布式文件系统。            |

---

## 逻辑时序

![逻辑时序](/images/2020-02-24-09-16-08.png)