---
layout: post
title:  "å•†å“ç§’æ€é—®é¢˜çš„æ€è€ƒ"
categories: æŠ€æœ¯
tags: ç§’æ€ è§£å†³æ–¹æ¡ˆ é—®é¢˜ seckill
author: wenfh2020
---

å•†å“ç§’æ€åœºæ™¯æ¯”è¾ƒå¸¸è§ï¼Œä¾‹å¦‚ 12306 æŠ¢ç¥¨ç­‰ç­‰ã€‚æ˜¯é«˜å¹¶å‘å’Œåˆ†å¸ƒå¼ç³»ç»Ÿå¤„ç†çš„ç»å…¸æ¡ˆä¾‹ã€‚ä¸ªäººæ²¡åšè¿‡ç§’æ€é¡¹ç›®ï¼Œä»…ä»…å¯¹è¿™ä¸ªé—®é¢˜æ„Ÿå…´è¶£ï¼Œç ”ç©¶äº†ä¸€ä¸‹ã€‚ä¸ªäººè®¤ä¸ºç§’æ€åœºæ™¯ä¸»è¦æœ‰ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜ï¼šåˆ°ç‚¹æŠ¢è´­è´Ÿè½½å’Œå•†å“è¶…é‡ã€‚



* content
{:toc}

---

## 1. è´Ÿè½½é—®é¢˜

ç§’æ€æ´»åŠ¨å¼€å§‹ï¼Œç»ˆç«¯è¯·æ±‚æ´ªæ°´èˆ¬æ¶Œå…¥æœåŠ¡å™¨ã€‚è¯·æ±‚åŒ…ç»è¿‡å»é‡å¤„ç†ï¼ˆuid/ip/otherï¼‰ï¼Œæ”¾è¿›æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ’é˜Ÿç­‰å¾…æ¶ˆè´¹å¤„ç†ã€‚

![æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†è´Ÿè½½](/images/2020-03-23-02-49-14.png){: data-action="zoom"}

---

## 2. å•†å“è¶…é‡é—®é¢˜

ç”¨æˆ·æŠ¢è´­æµç¨‹ï¼šç»ˆç«¯ç‚¹å‡»æŠ¢è´­æŒ‰é’®è¿›å…¥æŠ¢è´­é¡µé¢ -> å¡«å• -> æäº¤è®¢å•ã€‚

æ€è·¯ï¼š

* `logic server` æ¶ˆè´¹å¤„ç†æŠ¢è´­è¯·æ±‚ã€‚
* `num server` ç»´æŠ¤å•†å“æ•°é‡ã€‚
* `logic server` åœ¨å¤„ç†æŠ¢è´­è¯·æ±‚å‰å…ˆæ‰£é‡ï¼ŒæŠ¢è´­è¯·æ±‚å¤„ç†å¤±è´¥æˆ–æäº¤è®¢å•æ“ä½œè¶…æ—¶è¡¥é‡ã€‚
* `logic server` æ‰£é‡è¡¥é‡ä¸ `num server` äº¤äº’ã€‚
* `logic server` è¯·æ±‚æ ¹æ®å•†å“ id ä¸ºå› å­ï¼Œé€šè¿‡ä¸€è‡´æ€§å“ˆå¸Œï¼Œå°†åŒä¸€ä¸ªå•†å“çš„é‡æ“ä½œå‘é€åˆ°ç›¸åŒçš„ `num server` è¿›è¡Œå¤„ç†ã€‚
* `num server` å•†å“æ•°é‡è½åœ° MySQLï¼Œç”¨æ‚²è§‚é”ï¼Œä¸»åº“ä¸Šæ“ä½œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚
* `num server` ä¸ºå‡å°‘æ•°æ®åº“çš„è¯»å†™é¢‘ç‡ï¼Œä» MySQL æ‰£é™¤ä¸€æ‰¹æ¬¡çš„é‡ï¼Œæ”¾è¿›è¿›ç¨‹å†…å­˜ã€‚**æ‰¹æ¬¡æ•°æ®è¦è¿›è¡Œè®°å½•**ï¼Œæ¯æ¬¡å¤„ç†å®Œæ¯•ï¼Œå†è¿›è¡Œä¸‹ä¸€æ‰¹æ¬¡æ•°æ®çš„ç”³è¯·ã€‚æ‰¹æ¬¡å¤„ç†ç±»ä¼¼äºä»£ç†å’Œå‚å®¶å…³ç³»ï¼Œä»£ç†å–å®Œä¸€æ‰¹å•†å“ï¼Œå†ä»å‚å®¶è¿›è´§ã€‚
* `num server` å®šæ—¶ç›‘æ§å•†å“æ•°æ®é‡å˜åŒ–ï¼Œå¦‚æœé•¿æ—¶é—´ä¸è®¿é—®ï¼Œå†…å­˜ä¸­æ²¡åˆ†æ´¾å®Œçš„é‡è¦å›å†™ MySQLã€‚
* `num server` å¼‚å¸¸é€€å‡ºï¼Œé‡å¯æˆ–æ–°èŠ‚ç‚¹å¯åŠ¨éœ€è¦æ£€æŸ¥ä¸Šä¸€æ‰¹æ¬¡æ˜¯å¦å®Œæˆï¼Œå¦‚æœæ²¡å®Œæˆéœ€è¦ç»Ÿè®¡è¯¥æ‰¹æ¬¡çš„é‡åˆ†å‘æƒ…å†µï¼ŒæŠŠæ²¡æœ‰åˆ†å‘çš„é‡ç»Ÿè®¡å›æ”¶ï¼ˆæ¯ä¸ªåˆ†æ´¾å‡ºå»çš„é‡ï¼Œéƒ½é€šè¿‡ kafka è®°å½•æµæ°´ï¼‰ã€‚

![å•†å“è¶…é‡å¤„ç†](/images/2020-03-23-15-37-46.png){: data-action="zoom"}

---

## 3. æ€»ç»“

* ç³»ç»Ÿå°†å¤æ‚çš„å•†å“é‡ç»´æŠ¤é€»è¾‘éƒ½äº¤ç»™ `num server` äº†ï¼Œå‡å°‘äº†ä¸šåŠ¡å¤æ‚åº¦çš„è€¦åˆã€‚å…¶å®ƒä¸šåŠ¡æœåŠ¡åªéœ€é€šè¿‡ç®€å•æ¥å£è¿›è¡Œæ‰£é‡å’Œè¡¥é‡å³å¯ã€‚
* `num server` æ‰¹æ¬¡æ‰£é‡æ“ä½œï¼Œå‡å°‘äº†ä¸šåŠ¡å¯¹æ•°æ®åº“çš„è¯»å†™é¢‘ç‡ï¼Œæé«˜äº†ä¸šåŠ¡é€»è¾‘çš„å¹¶å‘ã€‚
* `num server` æ¯ä¸ªåˆ†æ´¾çš„é‡ï¼Œéƒ½éœ€è¦é€šè¿‡ `kafka` è®°å½•æµæ°´ï¼Œæ–¹ä¾¿å¼‚å¸¸ç»Ÿè®¡ï¼Œä¹Ÿç›¸å½“äºæ•°æ®åŸ‹ç‚¹ã€‚
* è¿™ä¸ªç§’æ€å¤„ç†æ–¹æ¡ˆï¼Œåœ¨åˆ†å¸ƒå¼é›†ç¾¤ä¸­æ·»åŠ äº† `ketama` ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œ`logic server` å°†åŒä¸€ä¸ªå•†å“é‡çš„ç»´æŠ¤é›†ä¸­åˆ°ä¸€ä¸ª `num server` èŠ‚ç‚¹ä¸­å¤„ç†ï¼Œå‡å°‘äº†å¤šèŠ‚ç‚¹å¤„ç†ï¼Œè¦å¢åŠ å…¨å±€åŠ é”çš„é—®é¢˜ã€‚å½“ç„¶è¿™å¢åŠ äº†ä¸€äº›å¤æ‚åº¦ï¼Œ`num server` å½“å•èŠ‚ç‚¹ `failover` å¤„ç†è¿‡ç¨‹ä¸­ï¼Œè¦å¤„ç†å¥½ä¸Šä¸€æ¬¡å¤„ç†çš„çŠ¶æ€ã€‚
* `num server` åªæ˜¯ä¸€ä¸ªå•†å“é‡çš„ç»´æŠ¤ï¼ŒåŒç†ï¼Œä¹Ÿå¯ä»¥é€šç”¨åˆ°å…¶å®ƒçš„ä¸€äº› id åˆ†é…ã€‚

## 4. å‚è€ƒ

* [å•†å“ç§’æ€é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ](https://blog.csdn.net/koastal/article/details/78995885)

---

> ğŸ”¥æ–‡ç« æ¥æºï¼š[wenfh2020.com](https://wenfh2020.com/)
