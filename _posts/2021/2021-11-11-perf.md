---
layout: post
title:  "perf å¸¸ç”¨æ–¹æ³•"
categories: tool
tags: perf
author: wenfh2020
---

perf æ˜¯å¸¸ç”¨çš„æ€§èƒ½åˆ†æå·¥å…·ï¼Œè®°å½•åŸºæœ¬ä½¿ç”¨æ–¹æ³•ã€‚



* content
{:toc}

---

## 1. æ¦‚è¿°

é€šè¿‡å‘½ä»¤å·¥å…·å›¾ç‰‡ï¼ŒæŸ¥çœ‹ `perf` éƒ½ä½¿ç”¨åœ¨å“ªä¸ªç¯èŠ‚ï¼Œperf çš„ä½¿ç”¨è¯´æ˜å¯ä»¥å‚è€ƒ [wiki](https://perf.wiki.kernel.org/index.php/Tutorial)ï¼Œæˆ–è€… `perf -h` å¸®åŠ©ã€‚

<div align=center><img src="/images/2021-06-26-06-17-04.png" data-action="zoom"/></div>

> å›¾ç‰‡æ¥æºï¼š[Linux Performance](https://www.brendangregg.com/linuxperf.html)ã€‚

---

## 2. åº”ç”¨

æ¯”è¾ƒç»å…¸çš„åº”ç”¨ï¼Œå°±æ˜¯ perf é‡‡é›†çš„æ•°æ®å¯è§†åŒ–â€”â€”ç«ç„°å›¾ï¼ˆon-cpu / off-cpuï¼‰ã€‚

> è¯¦æƒ…å‚è€ƒï¼š[è½¯ä»¶æ€§èƒ½æ£€æµ‹--ç«ç„°å›¾ ğŸ”¥](https://wenfh2020.com/2020/07/30/flame-diagram/)

* on-cpuã€‚

![ç«ç„°å›¾](/images/2020-07-30-19-33-44.png){:data-action="zoom"}

* off-cpuã€‚

<div align=center><img src="/images/2021-11-12-17-35-21.png" data-action="zoom"/></div>

---

## 3. å¸¸ç”¨å‘½ä»¤

```shell
# perf -h

 usage: perf [--version] [--help] [OPTIONS] COMMAND [ARGS]

 The most commonly used perf commands are:
   annotate        Read perf.data (created by perf record) and display annotated code
   archive         Create archive with object files with build-ids found in perf.data file
   bench           General framework for benchmark suites
   buildid-cache   Manage build-id cache.
   buildid-list    List the buildids in a perf.data file
   c2c             Shared Data C2C/HITM Analyzer.
   config          Get and set variables in a configuration file.
   data            Data file related processing
   diff            Read perf.data files and display the differential profile
   evlist          List the event names in a perf.data file
   ftrace          simple wrapper for kernel's ftrace functionality
   inject          Filter to augment the events stream with additional information
   kallsyms        Searches running kernel for symbols
   kmem            Tool to trace/measure kernel memory properties
   kvm             Tool to trace/measure kvm guest os
   list            List all symbolic event types
   lock            Analyze lock events
   mem             Profile memory accesses
   record          Run a command and record its profile into perf.data
   report          Read perf.data (created by perf record) and display the profile
   sched           Tool to trace/measure scheduler properties (latencies)
   script          Read perf.data (created by perf record) and display trace output
   stat            Run a command and gather performance counter statistics
   test            Runs sanity tests.
   timechart       Tool to visualize total system behavior during a workload
   top             System profiling tool.
   version         display the version of perf binary
   probe           Define new dynamic tracepoints
   trace           strace inspired tool
```

---

### 3.1. top

```shell
# perf top -h
perf top -p <pid>
```

<div align=center><img src="/images/2021-11-11-17-40-40.png" data-action="zoom"/></div>

---

### 3.2. å¾…ç»­

...

---

## 4. å‚è€ƒ

* [Off-CPU æ€§èƒ½åˆ†æ](http://blog.chinaunix.net/uid-28541347-id-5828248.html)
