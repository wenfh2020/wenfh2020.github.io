---
layout: post
title:  "github + jekyll å»ºè‡ªå·±çš„åšå®¢"
categories: éšç¬”
tags: blog
author: wenfh2020
---

è‡ªä»ç”¨ `markdown` å†™æ–‡æ¡£åï¼Œæ„Ÿè§‰å·²ç»ç¦»ä¸å¼€å®ƒäº†ã€‚å·¥ä½œè¿™ä¹ˆä¹…ï¼Œé—æ†¾æ²¡æœ‰æ¡ç†åŒ–åœ°å°†çŸ¥è¯†å®æ—¶è½åœ°ï¼Œåé¢åšäº†å¤§é‡é‡å¤åŠ³åŠ¨ã€‚å¹¸è¿ `github` æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„æºç ç®¡ç†å’Œåšå®¢å¹³å°ã€‚[[æˆ‘çš„åšå®¢]](https://wenfh2020.com)[[æ¡†æ¶]](https://github.com/wenfh2020/wenfh2020.github.io)æ¥è‡ª[Gaohaoyang](https://github.com/Gaohaoyang/gaohaoyang.github.io)ï¼Œç„¶è€Œå›½å†…çš„ç½‘ç»œå¯¹ `github` å¹³å°ä¸æ˜¯å¾ˆå‹å¥½ï¼Œå¦‚æœ‰æ¡ä»¶ï¼Œå¯ä»¥åŒæ—¶éƒ¨ç½²åšå®¢åˆ°è‡ªå·±çš„äº‘ä¸»æœºä¸Šã€‚



* content
{:toc}

---

## 1. æ•ˆæœ

![æ•ˆæœ](/images/2020-02-21-09-32-28.png){: data-action="zoom"}

---

## 2. æ¦‚è¿°

è‡ªå·±çš„åšå®¢ = `git` + `github` + `jekyll` + `vscode`

---

## 3. ç›®çš„

å¯¹çŸ¥è¯†è¿›è¡Œæ¡ç†åŒ–ç®¡ç†ã€‚æœ‰å‡ ç‚¹è¦æ±‚ï¼š

1. ç»ˆç«¯ç®€æ´ï¼Œæ— å¹¿å‘Šï¼Œæ— æ¨èã€‚
2. æ”¯æŒ `markdown` æ–‡æœ¬æ ¼å¼ï¼Œèƒ½å±•ç¤º `markdown` ç›®å½•ã€‚
3. æ”¯æŒæ–‡ç« åˆ†ç±»ç®¡ç†ã€‚
4. æ”¯æŒæ–‡ç« é¢˜ç›®æœç´¢ã€‚

---

## 4. æ­å»ºæµç¨‹

`github` ä¸Šæ­å»ºåšå®¢ï¼Œå¹¶ä¸å¤æ‚ã€‚`jekyll` + `github` æ­å»ºè¯¦ç»†æ–‡æ¡£ï¼Œç½‘ç»œä¸Šå¾ˆå¤šï¼Œå¯ä»¥å‚è€ƒä¸‹[è¿™ä¸ª](https://github.com/wonderseen/wonderseen.github.io)ï¼Œç»†èŠ‚é—®é¢˜ï¼Œè¿˜æ˜¯éœ€è¦èŠ±ç‚¹æ—¶é—´ï¼Œç®€å•è®°å½•ä¸‹æµç¨‹ï¼š

1. ä¼š `git` çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ã€‚
2. æ³¨å†Œä¸ª `github` è´¦å·ã€‚
3. åœ¨ `github` ä¸Šå»ºç«‹è‡ªå·±çš„åšå®¢é¡¹ç›® `xxx.github.io`ã€‚
4. æ‹·è´åˆ«äººçš„ `xxx.github.io` æ–‡ä»¶æ”¾åœ¨è‡ªå·±çš„ç›®å½•ä¸‹ã€‚
5. åˆ«äººçš„ `xxx.github.io` é¡¹ç›®æœ‰åˆ«äººçš„ä¿¡æ¯ï¼Œéœ€è¦æ›¿æ¢åˆ å‡æˆè‡ªå·±çš„ã€‚
6. æœ¬åœ°æŸ¥çœ‹åšå®¢é¢„è§ˆã€‚ï¼ˆè¯·å‚è€ƒè¿™ä¸ª[æ–‡æ¡£](https://github.com/wonderseen/wonderseen.github.io)çš„æ­å»ºæµç¨‹ï¼‰
7. æœ¬åœ°é¢„è§ˆæ­£å¸¸ï¼Œ`git` æäº¤ `github`ã€‚
8. æµè§ˆå™¨æ‰“å¼€é“¾æ¥ `xxx.github.io`ã€‚ï¼ˆåˆ·æ–°æœ‰æ—¶å€™ä¸æ˜¯å®æ—¶çš„ï¼Œå¤§æ¦‚éœ€è¦ç­‰ 1 åˆ†é’Ÿå·¦å³ï¼‰

---

## 5. ç³»ç»Ÿéƒ¨ç½²

å¦‚æœä½ åªç”¨ `xxx.github.io`ï¼Œåšå®¢ä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨ï¼Œä½†æ˜¯é¢„è§ˆä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œè¿˜æœ‰ `github` æœ‰æ—¶å€™ç½‘ç»œå¾ˆæ…¢ï¼Œè¿™æ—¶å€™éœ€è¦éƒ¨ç½²æœ¬åœ°çš„ï¼Œæˆ–è€…å°†å®ƒéƒ¨ç½²åœ¨äº‘æœåŠ¡ã€‚

### 5.1. Linux

#### 5.1.1. å®‰è£… ruby

centos7ï¼Œyum é»˜è®¤å®‰è£… `ruby` ç‰ˆæœ¬å¤ªä½ï¼Œéœ€è¦å‡çº§åˆ° 2.3 ä»¥ä¸Šã€‚

```shell
# å®‰è£…å¼€å‘å·¥å…·
yum groupinstall "Development tools"
# æ¸…ç†å®‰è£…è¿‡çš„ ruby æ–‡ä»¶
yum erase ruby ruby-libs ruby-mode ruby-rdoc ruby-irb ruby-ri ruby-docs
# å®‰è£…ä¾èµ–
yum -y install zlib-devel curl-devel openssl-devel httpd-devel apr-devel apr-util-devel mysql-devel
```

ä¸‹è½½æºç åŒ…å®‰è£…ï¼š

```shell
cd /home/soft
wget https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.5.tar.gz
tar zxf ruby-2.6.5.tar.gz
cd ruby-2.6.5
./configure
make && make install
# æŸ¥çœ‹ ruby è¿è¡Œç‰ˆæœ¬ã€‚
ruby -v
```

---

#### 5.1.2. æ‹‰å–ä»£ç 

```shell
cd /home/other/
git clone https://github.com/wenfh2020/wenfh2020.github.io.git
```

> æˆ‘çš„ blog å›¾ç‰‡ç°åœ¨è¶Šæ¥è¶Šå¤šäº†ï¼Œä»£ç æ‹‰å–å¯èƒ½ä¼šæœ‰ç‚¹æ…¢ï¼Œç›´æ¥ä¸‹è½½[å‹ç¼©åŒ…](https://codeload.github.com/wenfh2020/wenfh2020.github.io/zip/refs/heads/master)å¯èƒ½è¦å¿«ç‚¹ã€‚

---

#### 5.1.3. è¿è¡Œ jekyll æœåŠ¡

```shell
cd wenfh2020.github.io
gem install jekyll bundler
bundle install
# jekyll serve -wIt
bundle exec jekyll serve
```

---

### 5.2. MacOS

MacOS ä¸ Linux å®‰è£…å¤§åŒå°å¼‚ï¼Œä¸åŒ macOS ç³»ç»Ÿç‰ˆæœ¬å®‰è£…é‡åˆ°çš„é—®é¢˜å¯èƒ½ä¸ä¸€æ ·ã€‚

MacOS å‡çº§åï¼Œé™„å¸¦ç€å¾ˆå¤šè½¯ä»¶ä¼šå‡çº§ã€‚æœ€è¿‘æ‰‹è´±å°†ç³»ç»Ÿå‡çº§åˆ° `macOS big sur`ï¼Œç³»ç»Ÿå°† ruby 2.x å‡çº§åˆ° 3.x äº†ï¼Œç„¶åæœåŠ¡è·‘ä¸èµ·æ¥ï¼Œè¿™æ—¶å€™åº”è¯¥æŠŠ ruby æ¢å¤åˆ°æ—§ç‰ˆæœ¬ï¼Œé‡æ–°èµ°ä¸€æ¬¡å®‰è£…æµç¨‹ã€‚

> å·²ç»ç¨³å®šäº†çš„éƒ¨ç½²ç¯å¢ƒï¼Œå°±ä¸è¦éšä¾¿å‡çº§äº†ï¼Œå‡çº§åæœåŠ¡è·‘ä¸èµ·æ¥ï¼Œå¯¹äºå°ç™½ï¼Œé‡æ–°ç¨³å®šä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ… ğŸ¤¦â€â™‚ï¸ã€‚

---

#### 5.2.1. é—®é¢˜

> ERROR:  Error installing http_parser.rb:......
>
> listen-3.2.1 requires ruby version >= 2.2.7, ~> 2.2, which is incompatible with the current version, ruby 3.0.0p0

---

#### 5.2.2. å®‰è£…æµç¨‹

```shell
# æŸ¥çœ‹ç‰ˆæœ¬å·ï¼Œç¡®è®¤æ˜¯å¦è¢«å‡çº§ã€‚
sudo ruby -v
# å¸è½½
brew uinstall ruby
# å®‰è£…æ—§ç‰ˆ ruby
wget https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.0-preview1.tar.bz2
tar zxf ruby-2.6.0-preview1.tar.bz
cd ruby-2.6.0-preview1
./configure
make
make install
# å®‰è£… jekyll bundler
sudo gem install jekyll bundler
sudo bundle install
# ä½™ä¸‹ç¯èŠ‚ï¼Œæ‹‰å–ä»£ç ï¼Œè¿è¡Œ jekyll æœåŠ¡ï¼Œå‚è€ƒ Linux çš„æ­¥éª¤ã€‚
```

---

## 6. ä¼˜åŒ–

### 6.1. ä»£ç å—

* åŸæ¥æ¡†æ¶çš„ä»£ç å—ä»£ç è‡ªåŠ¨æ¢è¡Œï¼Œå­—ä½“å¤ªå¤§ï¼Œè¿˜å±è”½äº†æ»šåŠ¨æ¡æ»šåŠ¨åŠŸèƒ½ã€‚åœ¨æ‰‹æœºä¸Šçœ‹ï¼Œæ„Ÿè§‰æŒºåˆ«æ‰­çš„ï¼Œå¯ä»¥ä¿®æ”¹æ–‡ä»¶ `_sass/_syntax-highlighting.scss` ç›¸å…³é€‰é¡¹è®¾ç½®ã€‚

```scss
pre {
    margin: 12px 0;
    padding: 8px 12px;
    overflow-x: auto;      // æ»šåŠ¨æ¡æ»šåŠ¨åŠŸèƒ½
    word-wrap: break-word;      /* IE 5.5-7 */
    // white-space: pre-wrap;      /* current browsers */
    white-space: none;     // ä»£ç è‡ªåŠ¨æ¢è¡Œ  /* current browsers */
    > code {
        margin: 0;
        padding: 0;
        font-size: 12px;   // ä»£ç å—å­—ä½“å¤§å°
        color: #d1d1c9;
        border: none;
        background-color: #272822;
        line-height: 1em;
    }
}
```

* ä»£ç ä¸»é¢˜ï¼Œå¯ä»¥åœ¨ `_sass/_syntax-highlighting.scss` çš„ `.highlight` ä¸­ï¼Œè°ƒæ•´è‡ªå·±å–œæ¬¢çš„é¢œè‰²ã€‚ä¹Ÿå¯ä»¥å¼•ç”¨ç¬¬ä¸‰æ–¹æ’ä»¶ `highlight.min.js`

```scss
.highlight {
    border-radius: 3px;

    background: #272822;
    .hll { background-color: #272822; }
    .c { color: #6a9955 } /* Comment */
    ...
}
```

---

### 6.2. æœç´¢æ–‡ç« é¢˜ç›®åŠŸèƒ½

åŸæ¡†æ¶æ²¡æœ‰æœç´¢åŠŸèƒ½ï¼Œå¯ä»¥å°†è¿™ä¸ª[åšå®¢](https://www.codeboy.me/2015/07/11/jekyll-search/)çš„æœç´¢ç»„ä»¶æ·»åŠ è¿›æ¥ï¼Œè°¢è°¢äº†ã€‚æœ‰äº›ä»£ç æ²¡æ‰£å¾—å¥½ï¼Œæœç´¢é¡µé¢è¿˜æœ‰ç‚¹é—®é¢˜ï¼Œå‡‘åˆç€ç”¨å§ã€‚

> åŒå‡»é”®ç›˜ `ctrl` é”®ï¼Œè°ƒå‡ºæœç´¢æµ®åŠ¨çª—å£ï¼Œæˆ–è€…ç‚¹å‡»é¡µé¢å·¦ä¸‹è§’æœç´¢å›¾æ ‡ã€‚

![æœç´¢](/images/2020-03-10-18-28-52.png){: data-action="zoom"}

---

### 6.3. å…¶å®ƒåŠŸèƒ½

åé¢é™†ç»­æ·»åŠ äº†ä¸€äº›åŠŸèƒ½ï¼šä½œè€…ç‰ˆæƒä¿¡æ¯ï¼Œåˆ†äº«ï¼Œæ‰“èµï¼Œè¯„è®ºã€‚

![æ–°å¢åŠŸèƒ½](/images/2020-11-29-15-23-37.png){:data-action="zoom"}

---

### 6.4. æäº¤åšå®¢æ–‡ç« 

å†™åšå®¢æ–‡ç« ï¼Œç»å¸¸æ“ä½œçš„åªæœ‰ `images` å’Œ `_posts` ç›®å½•ï¼Œå°† `git` çš„å‡ ä¸ªå‘½ä»¤ `pull`ï¼Œ `add`ï¼Œ`commit`ï¼Œ`push` æ•´åˆåœ¨ä¸€èµ·æ–¹ä¾¿æ“ä½œã€‚

commit.sh

```shell
#!/bin/sh
# -------------------------------------------------------------------------------
# project  blog
# file:    commit.sh
# brief    æ•´åˆå¤šä¸ª git å‘½ä»¤ï¼Œæ–¹ä¾¿æäº¤æ–‡ç« ã€‚
# author:  wenfh2020
# date:    2020-02-18
# note:    ./commit.sh msg1 msg2
# -------------------------------------------------------------------------------

cd `dirname $0`
work_path=`pwd`
cd $work_path

if [ $# -lt 1 ]; then
    echo 'pls input commit message'
    exit 1
fi

_files='images _posts commit.sh refresh.sh _config.yml README.md _includes'
git pull && git add $_files && git commit -m "$(echo "$@")" && git push -u origin master && git status
```

---

## 7. å¯åŠ¨

* ç”¨è„šæœ¬ `refresh.sh` å¯åŠ¨ `jekyll` æœåŠ¡ï¼Œå½“åšå®¢ç›®å½•æœ‰æ›´æ–°æ—¶ï¼Œå®æ—¶ rebuildã€‚

```shell
#!/bin/sh
# -------------------------------------------------------------------------------
# project  refresh
# file:    refresh.sh
# brief    rebuild blog to run.
# author:  wenfh2020
# date:    2020-02-18
# note:    nohup ./refresh.sh >> /tmp/blog_log.txt 2>&1 &
# -------------------------------------------------------------------------------

cd `dirname $0`
work_path=`pwd`
cd $work_path

# find and kill
_pids=`ps -ef | grep 'jekyll serve' | grep -v grep | awk '{print $2}'`
for p in $_pids
do
    echo "kill pid=$p"
    kill -9 $p
done

# æœ‰æ—¶å€™ä¸èƒ½å®æ—¶åˆ·æ–°ï¼Œéœ€è¦åˆ é™¤ _site ç›®å½•ï¼Œé‡æ–°å¯åŠ¨ã€‚
[ -d _site ] && rm -r _site
# jekyll serve -wIt
bundle exec jekyll serve
```

* åå°è¿è¡Œ `jekyll` æœåŠ¡ã€‚contab åå°å®šæ—¶åˆ·æ–°ï¼Œå¯ä»¥å°†æ—¶é—´è®¾ç½®çŸ­ä¸€ç‚¹ã€‚

```shell
# crontab -e
* */12 * * * nohup /home/other/wenfh2020.github.io/refresh.sh >> /tmp/blog_log.txt 2>&1 &
```

* `jekyll` æœåŠ¡çš„å…¶å®ƒåŠŸèƒ½é…ç½®ï¼Œå¯ä»¥å‚è€ƒå¸®åŠ©ã€‚

```shell
jekyll serve -h
```

---

## 8. markdown ç¼–è¾‘å™¨

`markdown` ç¼–è¾‘å™¨å¯ä»¥ç”¨ `vscode`ï¼Œæœ‰ä¸å°‘æ’ä»¶æ”¯æŒã€‚

---

### 8.1. æ’ä»¶

| æ’ä»¶                        | æè¿°             |
| :-------------------------- | :--------------- |
| `Markdown All in Once`      | æ–‡æ¡£ç¼–å†™åŸºæœ¬æ’ä»¶ |
| `Markdown Preview Enhanced` | é¢„è§ˆ             |
| `markdownlint`              | è¯­æ³•æ£€æŸ¥         |
| `PicGo`                     | å¯ä»¥å…³è”å›¾åºŠ     |
| `Paste Image`               | åœ¨ç¼–è¾‘å™¨è´´å›¾     |

---

`Paste Image` æ’ä»¶ä¸»è¦é…ç½®é¡¹ï¼š

| é…ç½®é¡¹         | æ•°æ®                                                         |
| :------------- | :----------------------------------------------------------- |
| Base Path      | \${projectRoot}                                              |
| Insert Pattern | \${imageSyntaxPrefix}/\${imageFilePath}\${imageSyntaxSuffix} |
| Path           | \${projectRoot}/images                                       |

---

### 8.2. å›¾ç‰‡

åœ¨åšå®¢ç›®å½•ä¸‹åˆ›å»º `images` æ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜æ”¾æ–‡ç« ç”¨åˆ°çš„å›¾ç‰‡ã€‚

markdown æ’å…¥å›¾ç‰‡æ ¼å¼å¦‚ä¸‹ï¼š

> \!\[](/images/123.png){: data-action="zoom"}

---

## 9. ECS äº‘æœåŠ¡éƒ¨ç½²

`github` å›½å†…çš„ç½‘ç»œè®¿é—®ä¸æ˜¯å¾ˆç¨³å®šï¼Œç‰¹åˆ«æ˜¯å›¾ç‰‡åŠ è½½ã€‚è‡ªå·±æ‰‹ä¸Šæœ‰ä¸€å°äº‘ä¸»æœºï¼Œé¡ºæ‰‹éƒ¨ç½²ä¸Šå»ï¼Œäº‘ä¸»æœºä» `github` ä¸Šæ‹‰å–ä»£ç ï¼Œä¸¤ä¸ªå¹³å°å¯ä»¥åŒæ—¶ä½¿ç”¨ã€‚

åšå®¢æ›´æ–°æµç¨‹ï¼š

1. æœ¬åœ° `vscode` ç¼–è¾‘ `markdown` æ–‡æ¡£ã€‚
2. æœ¬åœ°ç½‘é¡µé¢„è§ˆåšå®¢ã€‚
3. ä¸Šä¼ ä»£ç åˆ° `github`ã€‚
4. äº‘ä¸»æœºä¸Šç”¨ `git pull` æ‹‰å–ä»£ç ã€‚ï¼ˆå¯ä»¥ç”¨ `crontab` å®šæ—¶æ‰§è¡Œè„šæœ¬ï¼‰
5. åˆ·æ–°åŸŸåå¯¹åº”åšå®¢ã€‚

---

### 9.1. åŸŸå

åŸŸåä¸æ˜¯å¿…é¡»çš„ï¼Œå®ƒçš„å¥½å¤„å°±ä¸ç”¨å¤šè¯´äº†ã€‚

1. é˜¿é‡Œäº‘è´­ä¹°åŸŸåã€‚
2. é˜¿é‡Œäº‘åŸŸåç»‘å®šäº‘ä¸»æœº ipã€‚
   > ä»¥å‰æ²¡æœ‰å¤‡æ¡ˆè¿‡çš„ï¼ŒåŸŸåéœ€è¦å®åè®¤è¯ï¼Œå¤‡æ¡ˆï¼Œè¿™éœ€è¦ç­‰ï¼Œå¯ä»¥å…ˆç”¨ ipã€‚

---

### 9.2. å®‰è£…æœåŠ¡

å‚è€ƒä¸Šé¢ `ç³»ç»Ÿéƒ¨ç½²` ç« èŠ‚ã€‚

---

### 9.3. nginx é…ç½®

* æ·»åŠ åŸŸååˆ°æ–°çš„ nginx é…ç½®æ–‡ä»¶ã€‚
* [http å‡çº§ https](https://blog.csdn.net/b_aihe/article/details/88549757)ï¼Œè¯ä¹¦æ˜¯å…è´¹çš„ã€‚ï¼ˆ[è¯ä¹¦åˆ°æœŸï¼Œå…è´¹å»¶é•¿ä½¿ç”¨æ—¶é—´](https://blog.csdn.net/yunweifun/article/details/113274017)ï¼‰

```shell
mkdir -p /etc/nginx/vhost
cd /etc/nginx/vhost
vim blog.conf
```

```shell
# æ³¨æ„ nginx.conf ä¸­é»˜è®¤çš„ 80 ç«¯å£å¤„ç†.
# å¦‚æœæ²¡æœ‰ä½¿ç”¨ï¼Œå¯ä»¥æ³¨é‡Šæ‰ nginx.conf çš„ 80 ç«¯å£çš„ serverã€‚

server {
    listen 80;
    server_name  wenfh2020.com www.wenfh2020.com;
    # http è½¬ https
    return 301   https://$host$request_uri;
}

server {
    listen       443 ssl;
    server_name  wenfh2020.com www.wenfh2020.com;
    ssl_certificate /usr/local/nginx/ssl/blog/3515736_wenfh2020.com.pem;
    ssl_certificate_key /usr/local/nginx/ssl/blog/3515736_wenfh2020.com.key;
    ssl_session_timeout 5m;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers AESGCM:ALL:!DH:!EXPORT:!RC4:+HIGH:!MEDIUM:!LOW:!aNULL:!eNULL;
    ssl_prefer_server_ciphers on;

    root /home/other/wenfh2020.github.io;
    # åå‘ä»£ç†
    location / {
        proxy_pass http://localhost:4000;
    }

    # é˜²æ­¢ç›—é“¾
    location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$ {
        root /home/other/wenfh2020.github.io;
        valid_referers none blocked server_names  ~\.google\. ~\.baidu\. ~\.bing\.;
        if ($invalid_referer) {
            return 403;
        }

        expires    30d;
        access_log off;
    }
}
```

* æ·»åŠ æ–°åŸŸåæ–‡ä»¶è·¯å¾„åˆ°ä¸»é…ç½®æ–‡ä»¶ã€‚

```shell
vim /etc/nginx/nginx.conf
```

```shell
http {
    ...
    # æ·»åŠ æ–°åŸŸåæ–‡ä»¶
    include /etc/nginx/vhost/*.conf;
}
```

* åˆ·æ–° nginx é…ç½®

```shell
nginx -s reload
```

---

## 10. å‚è€ƒ

* [jekyll å®˜ç½‘](http://jekyllcn.com/)
* [simple-jekyll-search](http://npm.taobao.org/package/simple-jekyll-search)
* [é€šè¿‡Nginxå®ç°å›¾ç‰‡é˜²ç›—é“¾](https://birdteam.net/5072)
