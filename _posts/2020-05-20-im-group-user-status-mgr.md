---
layout: post
title:  "[å³æ—¶é€šè®¯] åˆ†å¸ƒå¼ç³»ç»Ÿ-ç”¨æˆ·åœ¨çº¿çŠ¶æ€ç®¡ç†"
categories: å³æ—¶é€šè®¯
tags: im group
author: wenfh2020
--- 

åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œç”¨æˆ·è¿æ¥åˆ°ä¸åŒçš„ç‰©ç†è®¾å¤‡ï¼Œåœ¨ä¸åŒçš„è¿›ç¨‹é‡Œå·¥ä½œã€‚ç‹¬ç«‹è¿›ç¨‹åœ¨å¤„ç†ä¸€äº›ç”¨æˆ·å…³ç³»æ€§æ¯”è¾ƒå¼ºçš„ä¸šåŠ¡æ—¶ï¼Œæ¶‰åŠå¤šä¸ªè¿›ç¨‹äº¤äº’ï¼Œé€»è¾‘è¦æ¯”å•æœå¤æ‚å¾ˆå¤šã€‚å¯¹äºç›¸å¯¹è¾ƒå°çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæˆ‘ä»¬ä»ç„¶å¸Œæœ›å¯»æ±‚ä¸€ç§ç®€å•çš„åŠŸèƒ½å®ç°æ–¹å¼ã€‚



* content
{:toc}

---

## 1. è§£è€¦

åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæ¯ä¸ªæœåŠ¡èŠ‚ç‚¹éƒ½å¯ä»¥ç›¸äº’é€šä¿¡ï¼Œæˆ‘ä»¬å¸Œæœ›ï¼ŒèŠ‚ç‚¹é—´å°½é‡è§£è€¦ï¼Œæ˜¾ç„¶ B å›¾çš„é€»è¾‘æ›´åŠ æ¸…æ™°ã€‚

![é€šä¿¡è§£è€¦](/images/2020-05-21-20-02-12.png){:data-action="zoom"}

---

## 2. æ¶æ„

æˆ‘ä»¬æ·»åŠ  redis é›†ç¾¤è¿›è¡Œæ•°æ®å…±äº«ï¼Œå‡å°‘èŠ‚ç‚¹é—´çš„é€šä¿¡ã€‚

![åˆ†å¸ƒå¼æ¶æ„](/images/2020-05-21-20-02-49.png){:data-action="zoom"}

æ¶æ„ç‰¹ç‚¹ï¼š

* `gate` æ¥å…¥æœåŠ¡é›†ç¾¤ï¼Œè´Ÿè´£å®¢æˆ·ç«¯æ¥å…¥å’Œå®¢æˆ·ç«¯ä¸šåŠ¡åè®®çš„è·¯ç”±ï¼Œï¼ˆä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼‰è·¯ç”±åˆ°åç«¯é€»è¾‘æœåŠ¡è¿›è¡Œå¤„ç†ã€‚
* `logic` é€»è¾‘æœåŠ¡é›†ç¾¤ï¼Œè´Ÿè´£å®¢æˆ·ç«¯ä¸šåŠ¡åŠŸèƒ½å®ç°ã€‚
* `redis cluster` æ•°æ®ç¼“å­˜ï¼Œæ–¹ä¾¿ä¸åŒç±»å‹èŠ‚ç‚¹æœåŠ¡å…±äº«æ•°æ®ã€‚

---

**`gate` å†™æ•°æ®ï¼Œ`logic` è¯»æ•°æ®ã€‚**

ç”¨æˆ·çš„å®æ—¶åœ¨çº¿çŠ¶æ€è¢«åˆ†æ•£ä¿å­˜åœ¨å¤šä¸ª `gate` æœåŠ¡ä¸Šã€‚`gate` æœåŠ¡å°†ç”¨æˆ·åœ¨çº¿çŠ¶æ€å®æ—¶åŒæ­¥åˆ° redis é›†ç¾¤ã€‚

å½“ `logic` æœåŠ¡å¤„ç†ç¾¤èŠæ—¶ï¼Œæˆ‘ä»¬éœ€è¦è·å¾—å½“å‰ç¾¤ç»„æ‰€æœ‰æˆå‘˜çš„åœ¨çº¿çŠ¶æ€ï¼Œè¿™æ—¶å€™æˆ‘ä»¬ä¸éœ€è¦éå† `gate` æœåŠ¡è¿›è¡Œè·å–ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡ redis è·å–å³å¯ã€‚

---

## 3. Session

é€»è¾‘æœåŠ¡èŠ‚ç‚¹ç›´æ¥ä» redis ä¸Šè·å–æ•°æ®ï¼Œå¯è°“ç®€å•ç²—æš´ï¼Œæˆ‘ä»¬ä»ç„¶æœ‰å¾ˆå¤šç»†èŠ‚é—®é¢˜éœ€è¦å¤„ç†ã€‚

è¿™æ · redis è´Ÿè½½å¯èƒ½ä¼šæˆä¸ºä¸€ä¸ªæ–°çš„é—®é¢˜ã€‚ç‰¹åˆ«æ˜¯æ´»è·ƒçš„å¤§ç¾¤ï¼Œæ¯æ¬¡å‘é€æ¶ˆæ¯ï¼Œéƒ½è¦ä» redis å–å‡ºå¤§é‡çš„ç”¨æˆ·åœ¨çº¿çŠ¶æ€æ•°æ®ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªæ˜æ™ºåšæ³•ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠè¿›ç¨‹çš„å†…å­˜åˆ©ç”¨èµ·æ¥ â€”â€” sessionã€‚è¿™æ ·è™½ç„¶ä¸èƒ½ä¿è¯ session é‡Œçš„æ•°æ®ä¸ redis åŒæ­¥ï¼Œä¹Ÿä¸€å®šç¨‹åº¦ä¸Šå‡è½»äº† redis çš„è´Ÿè½½ã€‚å¯ä»¥æ ¹æ®ç³»ç»Ÿçš„è´Ÿè½½è®¾ç½® session çš„æœ‰æ•ˆæ—¶é—´ã€‚

é‚£äº›åŸæ¥ç¦»çº¿ï¼Œåé¢ä¸Šçº¿çš„ç”¨æˆ·ï¼Œæ²¡æœ‰å®æ—¶å‘é€çš„æ¶ˆæ¯ï¼Œå°†è¢«ä¿å­˜ä¸ºç¦»çº¿æ¶ˆæ¯ã€‚å¹¶é€šè¿‡å…¶å®ƒç­–ç•¥å®šæ—¶å¯¹ç¦»çº¿æ¶ˆæ¯è¿›è¡Œæ¨é€ã€‚

![ç¼“å­˜](/images/2020-05-21-20-44-09.png){:data-action="zoom"}

---

> ğŸ”¥æ–‡ç« æ¥æºï¼š[wenfh2020.com](https://wenfh2020.com/2020/05/20/im-group-user-status-mgr/)