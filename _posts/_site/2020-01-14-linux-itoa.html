<p><code class="highlighter-rouge">linux</code> ä¸‹ï¼Œéœ€è¦å°†æ•´æ•°è½¬åŒ–ä¸ºäºŒè¿›åˆ¶ï¼Œå¾ˆè‡ªç„¶æƒ³åˆ° <code class="highlighter-rouge">itoa</code>ï¼Œå‘ç°è¿™å‡½æ•°ç«Ÿç„¶ç¼–è¯‘ä¸é€šè¿‡ã€‚æ ‡å‡†åº“ä¸­è²Œä¼¼æœ‰è¿™ä¸ª<a href="http://www.cplusplus.com/reference/cstdlib/itoa/">å®ç°</a>ï¼Œä¸æ˜ç™½äº†~ ç½‘ä¸Šå‚è€ƒäº†<a href="https://stackoverflow.com/questions/190229/where-is-the-itoa-function-in-linux">å¸–å­</a>ï¼Œä¸‹é¢å®ç°ä»£ç ï¼š</p>

<ul id="markdown-toc">
  <li><a href="#1-æ–¹æ³•ä¸€" id="markdown-toc-1-æ–¹æ³•ä¸€">1. æ–¹æ³•ä¸€</a></li>
  <li><a href="#2-æ–¹æ³•äºŒ" id="markdown-toc-2-æ–¹æ³•äºŒ">2. æ–¹æ³•äºŒ</a>    <ul>
      <li><a href="#21-æ–¹æ³•ä¸‰" id="markdown-toc-21-æ–¹æ³•ä¸‰">2.1. æ–¹æ³•ä¸‰</a></li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="1-æ–¹æ³•ä¸€">1. æ–¹æ³•ä¸€</h2>

<p>æ„Ÿè§‰è¿™æ–¹æ³•æœ‰ç‚¹è´¹è„‘ï¼Œä¸æ˜¯å¾ˆç›´è§‚ã€‚</p>

<blockquote>
  <p>å–æ¨¡çš„æ–¹æ³•ä¸€èˆ¬éƒ½æ˜¯ä»ä½ä½åˆ°é«˜ä½ï¼Œæ‰€ä»¥ä¿å­˜çš„å­—ç¬¦ä¸²ç»“æœä¸€èˆ¬ä¼šè·Ÿéœ€è¦çš„ç»“æœç›¸åï¼Œéœ€è¦å€’è½¬ï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä»å­—ç¬¦ä¸²æ•°ç»„åé¢å¼€å§‹å¾€å‰ä¿å­˜ã€‚</p>
</blockquote>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
</span>
<span class="cp">#define BUF_LEN 64
</span>
<span class="kt">char</span><span class="o">*</span> <span class="nf">i2bin</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">v</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">memcpy</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">"0"</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">buf</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">char</span><span class="o">*</span> <span class="n">dst</span> <span class="o">=</span> <span class="n">buf</span> <span class="o">+</span> <span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="o">*</span><span class="n">dst</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dst</span> <span class="o">-</span> <span class="n">buf</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="o">*--</span><span class="n">dst</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="sc">'0'</span><span class="p">;</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">memcpy</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">buf</span> <span class="o">+</span> <span class="n">len</span> <span class="o">-</span> <span class="n">dst</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">buf</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">v</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%llu"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">);</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="n">BUF_LEN</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">res</span> <span class="o">=</span> <span class="n">i2bin</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">BUF_LEN</span><span class="p">);</span>
    <span class="n">res</span> <span class="o">?</span> <span class="n">printf</span><span class="p">(</span><span class="s">"data: %s, len: %lu</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">i2bin</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">BUF_LEN</span><span class="p">),</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">))</span>
        <span class="o">:</span> <span class="n">printf</span><span class="p">(</span><span class="s">"fail</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<h2 id="2-æ–¹æ³•äºŒ">2. æ–¹æ³•äºŒ</h2>

<p>å‚è€ƒ redis sds.c æºç ï¼ŒæŠŠä¸‹é¢æºç çš„ 10 æ”¹ä¸º 2 å³å¯ã€‚</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">sdsll2str</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">aux</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">v</span><span class="p">;</span>
    <span class="kt">size_t</span> <span class="n">l</span><span class="p">;</span>

    <span class="cm">/* Generate the string representation, this method produces
     * an reversed string. */</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="o">-</span><span class="n">value</span> <span class="o">:</span> <span class="n">value</span><span class="p">;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">s</span><span class="p">;</span>
    <span class="k">do</span> <span class="p">{</span>
        <span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="sc">'0'</span> <span class="o">+</span> <span class="p">(</span><span class="n">v</span> <span class="o">%</span> <span class="mi">10</span><span class="p">);</span> <span class="c1">// 2 </span>
        <span class="n">v</span> <span class="o">/=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// 2</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">v</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="sc">'-'</span><span class="p">;</span>

    <span class="cm">/* Compute length and add null term. */</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">s</span><span class="p">;</span>
    <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>

    <span class="cm">/* Reverse the string. */</span>
    <span class="n">p</span><span class="o">--</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">s</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">aux</span> <span class="o">=</span> <span class="o">*</span><span class="n">s</span><span class="p">;</span>
        <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
        <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">aux</span><span class="p">;</span>
        <span class="n">s</span><span class="o">++</span><span class="p">;</span>
        <span class="n">p</span><span class="o">--</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">l</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<h3 id="21-æ–¹æ³•ä¸‰">2.1. æ–¹æ³•ä¸‰</h3>

<p>å¯ä»¥å‚è€ƒä¸‹ linux æºç ï¼Œçœ‹çœ‹ printf æ˜¯æ€ä¹ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ã€‚å‚è€ƒ <a href="https://github.com/torvalds/linux/blob/master/arch/x86/boot/printf.c">github æºç </a></p>

<hr />

<blockquote>
  <p>ğŸ”¥æ–‡ç« æ¥æºï¼š<a href="https://wenfh2020.com/">wenfh2020.com</a></p>
</blockquote>
