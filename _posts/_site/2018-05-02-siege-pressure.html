<p>siege 是一个轻量级的压力测试工具，http 测试方便实用。</p>

<ul id="markdown-toc">
  <li><a href="#1-概述" id="markdown-toc-1-概述">1. 概述</a></li>
  <li><a href="#2-测试机器" id="markdown-toc-2-测试机器">2. 测试机器</a></li>
  <li><a href="#3-siege" id="markdown-toc-3-siege">3. Siege</a>    <ul>
      <li><a href="#31-安装" id="markdown-toc-31-安装">3.1. 安装</a></li>
      <li><a href="#32-命令参数" id="markdown-toc-32-命令参数">3.2. 命令参数</a></li>
      <li><a href="#33-测试方法" id="markdown-toc-33-测试方法">3.3. 测试方法</a></li>
      <li><a href="#34-测试结果" id="markdown-toc-34-测试结果">3.4. 测试结果</a></li>
      <li><a href="#35-系统负载" id="markdown-toc-35-系统负载">3.5. 系统负载</a></li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="1-概述">1. 概述</h2>

<p>压力测试是服务开发中十分重要的一环，需要测试服务在高并发的环境下功能的稳定性以及性能的瓶颈，根据测试结果输出详细的测试数据，有针对性地对服务进行优化。</p>

<h2 id="2-测试机器">2. 测试机器</h2>

<table>
  <thead>
    <tr>
      <th style="text-align: left">选项</th>
      <th style="text-align: left">描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><strong>系统</strong></td>
      <td style="text-align: left">CentOS release 6.5 (Final)</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>CPU</strong></td>
      <td style="text-align: left">model name   : Intel(R) Pentium(R) CPU G2030 @ 3.00GHz <br /> processor       : 1 <br /> cpu cores       : 2</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>系统</strong></td>
      <td style="text-align: left">MemTotal:      3624428 kB</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="3-siege">3. Siege</h2>

<p>它是一款开源的压力测试工具，设计用于评估WEB应用在压力下的承受能力。可以根据配置对一个WEB站点进行多用户的并发访问，记录每个用户所有请求过程的相应时间，并在一定数量的并发访问下重复进行。</p>

<hr />

<h3 id="31-安装">3.1. 安装</h3>

<p>通过 yum install siege 命令可以安装，但是一般会根据系统源进行下载，下载的版本比较低，建议根据下列操作步骤安装最新版本。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget http://download.joedog.org/siege/siege-4.0.4.tar.gz
<span class="nb">tar</span> <span class="nt">-zxvf</span> siege-4.0.4.tar.gz
<span class="nb">cd </span>siege-4.0.4/
./configure
make
make <span class="nb">install</span>
</code></pre></div></div>

<hr />

<h3 id="32-命令参数">3.2. 命令参数</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>siege  <span class="nt">-c</span> 并发用户数 <span class="nt">-r</span> 循环次数 <span class="nt">--header</span> <span class="s2">"http协议头设置"</span>  <span class="s1">'请求链接'</span>
</code></pre></div></div>

<blockquote>
  <p>【注意】根据机器的情况，siege一般并发的用户数，默认是 255，最高可以设置 1000 个或者更多（需要修改配置limit限制，vim /root/.siege/siege.conf，siege 工具每个用户会启用一个线程比较耗性能，所以根据实际情况设置用户数量），因为 HTTP 是短连接，机器端口号是 0 - 65535，并发数太高，siege很容易会把本地的端口耗尽。</p>
</blockquote>

<hr />

<h3 id="33-测试方法">3.3. 测试方法</h3>

<p>测试 50000 个数据包，500 个用户每个用户发送 100 个测试包。</p>

<p>header 头填充 Cookie 的相关信息，token 和 userid。</p>

<p>操作方法：POST</p>

<p>协议：url: http://192.168.1.1:1111/xxx/im/relation/user/friend/check</p>

<p>协议包体：./friend_check.json</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>siege <span class="nt">-c</span> 500 <span class="nt">-r</span> 100 <span class="nt">--header</span> <span class="s2">"Cookie:token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyaWQjIsImV4cCI6MTU1MjE4MTAzMH0.Cz8MN2kREkueZC4tAwGw_r0qv7b0oRgli8mYOozXHG8;userid=2"</span> <span class="s1">'http://192.168.1.1:1111/xxx/im/relation/user/friend/check POST &lt; ./friend_check.json'</span>
</code></pre></div></div>

<hr />

<h3 id="34-测试结果">3.4. 测试结果</h3>

<table>
  <thead>
    <tr>
      <th style="text-align: left">选项</th>
      <th style="text-align: left">描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Transactions</td>
      <td style="text-align: left">已完成的事务总数</td>
    </tr>
    <tr>
      <td style="text-align: left">Availability</td>
      <td style="text-align: left">完成的成功率</td>
    </tr>
    <tr>
      <td style="text-align: left">Elapsed time</td>
      <td style="text-align: left">总共使用的时间</td>
    </tr>
    <tr>
      <td style="text-align: left">Data transferred</td>
      <td style="text-align: left">响应中数据的总大小</td>
    </tr>
    <tr>
      <td style="text-align: left">Response time</td>
      <td style="text-align: left">显示网络连接的速度</td>
    </tr>
    <tr>
      <td style="text-align: left">Transaction rate</td>
      <td style="text-align: left">平均每秒完成的事务数</td>
    </tr>
    <tr>
      <td style="text-align: left">Throughput</td>
      <td style="text-align: left">平均每秒传送的数据量</td>
    </tr>
    <tr>
      <td style="text-align: left">Concurrency</td>
      <td style="text-align: left">实际最高并发链接数</td>
    </tr>
    <tr>
      <td style="text-align: left">Successful transactions</td>
      <td style="text-align: left">成功处理的次数</td>
    </tr>
    <tr>
      <td style="text-align: left">Failed transactions</td>
      <td style="text-align: left">失败处理的次数</td>
    </tr>
    <tr>
      <td style="text-align: left">Longest transaction</td>
      <td style="text-align: left">最长事务处理的时间</td>
    </tr>
    <tr>
      <td style="text-align: left">Shortest transaction</td>
      <td style="text-align: left">最短事务处理时间</td>
    </tr>
  </tbody>
</table>

<p>结果：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Transactions:                 500000 hits
Availability:                 100.00 %
Elapsed <span class="nb">time</span>:                 115.34 secs
Data transferred:              19.55 MB
Response <span class="nb">time</span>:                  0.20 secs
Transaction rate:            4335.01 trans/sec
Throughput:                     0.17 MB/sec
Concurrency:                  865.90
Successful transactions:      500000
Failed transactions:               0
Longest transaction:            3.03
Shortest transaction:           0.00
</code></pre></div></div>

<hr />

<h3 id="35-系统负载">3.5. 系统负载</h3>

<p>压力测试过程中系统负载情况</p>

<p><img src="/images/2020-03-11-08-23-10.png" alt="系统负载" data-action="zoom" /></p>

<hr />

<blockquote>
  <p>🔥文章来源：<a href="https://wenfh2020.com/">wenfh2020.com</a></p>
</blockquote>
