<p>å¯ä»¥é€šè¿‡ gdb / vscode è°ƒè¯• redis æºç ï¼Œç†è§£ redis å·¥ä½œæµç¨‹ã€‚</p>

<ul id="markdown-toc">
  <li><a href="#1-è§†é¢‘" id="markdown-toc-1-è§†é¢‘">1. è§†é¢‘</a></li>
  <li><a href="#2-gdb-å¸¸ç”¨å‘½ä»¤" id="markdown-toc-2-gdb-å¸¸ç”¨å‘½ä»¤">2. gdb å¸¸ç”¨å‘½ä»¤</a></li>
  <li><a href="#3-å®‰è£…ç¼–è¯‘-redis" id="markdown-toc-3-å®‰è£…ç¼–è¯‘-redis">3. å®‰è£…ç¼–è¯‘ redis</a></li>
  <li><a href="#4-gdb-è°ƒè¯•æµç¨‹" id="markdown-toc-4-gdb-è°ƒè¯•æµç¨‹">4. gdb è°ƒè¯•æµç¨‹</a></li>
  <li><a href="#5-vscode-è°ƒè¯•æµç¨‹" id="markdown-toc-5-vscode-è°ƒè¯•æµç¨‹">5. vscode è°ƒè¯•æµç¨‹</a>    <ul>
      <li><a href="#51-å¯åŠ¨-vscode" id="markdown-toc-51-å¯åŠ¨-vscode">5.1. å¯åŠ¨ vscode</a></li>
      <li><a href="#52-vscode-é¡¹ç›®é…ç½®" id="markdown-toc-52-vscode-é¡¹ç›®é…ç½®">5.2. vscode é¡¹ç›®é…ç½®</a></li>
      <li><a href="#53-vscode-è°ƒè¯•" id="markdown-toc-53-vscode-è°ƒè¯•">5.3. vscode è°ƒè¯•</a></li>
    </ul>
  </li>
  <li><a href="#6-å‚è€ƒ" id="markdown-toc-6-å‚è€ƒ">6. å‚è€ƒ</a></li>
</ul>

<hr />

<h2 id="1-è§†é¢‘">1. è§†é¢‘</h2>

<ul>
  <li>bilibili  (<a href="https://www.bilibili.com/video/av83070640">Debug Redis in VsCode with Gdb</a>)</li>
  <li>youtube (<a href="https://www.youtube.com/watch?v=QltK3vV5Slw">Debug Redis in VsCode with Gdb</a> )</li>
  <li>å¯¹åº”æ“ä½œæ–‡æ¡£ï¼š <a href="https://github.com/wenfh2020/youtobe/blob/master/redis-debug.md">github</a></li>
</ul>

<hr />

<h2 id="2-gdb-å¸¸ç”¨å‘½ä»¤">2. gdb å¸¸ç”¨å‘½ä»¤</h2>

<p>è¯¦ç»†æ–‡æ¡£é€šè¿‡å‘½ä»¤ <code class="highlighter-rouge">man gdb</code> æŸ¥çœ‹ã€‚</p>

<table>
  <thead>
    <tr>
      <th>å‘½ä»¤</th>
      <th>æ“ä½œ</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>r</td>
      <td>è¿è¡Œè°ƒè¯•</td>
    </tr>
    <tr>
      <td>n</td>
      <td>ä¸‹ä¸€æ­¥</td>
    </tr>
    <tr>
      <td>c</td>
      <td>ç»§ç»­è¿è¡Œ</td>
    </tr>
    <tr>
      <td>ctrl + c</td>
      <td>ä¸­æ–­ä¿¡å·</td>
    </tr>
    <tr>
      <td>c/continue</td>
      <td>ä¸­æ–­åç»§ç»­è¿è¡Œ</td>
    </tr>
    <tr>
      <td>s</td>
      <td>è¿›å…¥ä¸€ä¸ªå‡½æ•°</td>
    </tr>
    <tr>
      <td>finish</td>
      <td>é€€å‡ºå‡½æ•°</td>
    </tr>
    <tr>
      <td>l</td>
      <td>åˆ—å‡ºä»£ç è¡Œ</td>
    </tr>
    <tr>
      <td>b</td>
      <td>æ–­ç‚¹<br />æ˜¾ç¤ºæ–­ç‚¹åˆ—è¡¨ info b<br />åˆ é™¤æ–­ç‚¹ delete number<br />æ¸…é™¤æ–­ç‚¹ clear</td>
    </tr>
    <tr>
      <td>n</td>
      <td>ä¸‹ä¸€æ­¥</td>
    </tr>
    <tr>
      <td>until</td>
      <td>è·³è‡³è¡Œå·<br />until <number></number></td>
    </tr>
    <tr>
      <td>p</td>
      <td>æ‰“å°<br />æ‰“å°æ•°ç»„ä¿¡æ¯ p *array@len<br />p/x æŒ‰åå…­è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡</td>
    </tr>
    <tr>
      <td>bt/backtrace</td>
      <td>å †æ ˆbt &lt;-n&gt;<br />-nè¡¨ä¸€ä¸ªè´Ÿæ•´æ•°ï¼Œè¡¨ç¤ºåªæ‰“å°æ ˆåº•ä¸‹nå±‚çš„æ ˆä¿¡æ¯ã€‚</td>
    </tr>
    <tr>
      <td>f/frame</td>
      <td>è¿›å…¥æŒ‡å®šå †æ ˆå±‚<br /> f <number></number></td>
    </tr>
    <tr>
      <td>thread apply all bt</td>
      <td>æ˜¾ç¤ºçº¿ç¨‹æ‰€æœ‰å †æ ˆ</td>
    </tr>
    <tr>
      <td>attach</td>
      <td>ç»‘å®šè¿›ç¨‹è°ƒè¯•<br />attach &lt;-p pid&gt;</td>
    </tr>
    <tr>
      <td>detach</td>
      <td>å–æ¶ˆç»‘å®šè°ƒè¯•è¿›ç¨‹</td>
    </tr>
    <tr>
      <td>disassemble</td>
      <td>çœ‹äºŒè¿›åˆ¶æ•°æ®<br />disassemble <func></func></td>
    </tr>
    <tr>
      <td>x</td>
      <td>æŸ¥çœ‹å†…å­˜</td>
    </tr>
    <tr>
      <td>focus</td>
      <td>æ˜¾ç¤ºæºç ç•Œé¢</td>
    </tr>
    <tr>
      <td>display</td>
      <td>æ˜¾ç¤ºå˜é‡</td>
    </tr>
    <tr>
      <td>info registers</td>
      <td>æŸ¥çœ‹å¯„å­˜å™¨</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="3-å®‰è£…ç¼–è¯‘-redis">3. å®‰è£…ç¼–è¯‘ redis</h2>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget http://download.redis.io/releases/redis-3.2.8.tar.gz
<span class="nb">tar </span>xzf redis-3.2.8.tar.gz
<span class="nb">cd </span>redis-3.2.8
</code></pre></div></div>

<p>æ›´æ–° Makefileï¼Œä¿®æ”¹ç›¸åº”ç¼–è¯‘é¡¹</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim src/Makefile
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># OPTIMIZATION?=-O2</span>
OPTIMIZATION?<span class="o">=</span><span class="nt">-O0</span>
<span class="c"># REDIS_LD=$(QUIET_LINK)$(CC) $(FINAL_LDFLAGS)</span>
<span class="nv">REDIS_LD</span><span class="o">=</span><span class="si">$(</span>QUIET_LINK<span class="si">)$(</span>CC<span class="si">)</span> <span class="si">$(</span>FINAL_LDFLAGS<span class="si">)</span> <span class="si">$(</span>OPTIMIZATION<span class="si">)</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make clean<span class="p">;</span> make
</code></pre></div></div>

<hr />

<h2 id="4-gdb-è°ƒè¯•æµç¨‹">4. gdb è°ƒè¯•æµç¨‹</h2>

<table>
  <thead>
    <tr>
      <th>æ­¥éª¤</th>
      <th>å‘½ä»¤</th>
      <th>æè¿°</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>sudo gdb â€“args ./src/redis-server redis.conf</td>
      <td>å¯åŠ¨è°ƒè¯•</td>
    </tr>
    <tr>
      <td>2</td>
      <td>r</td>
      <td>è¿è¡Œç¨‹åº</td>
    </tr>
    <tr>
      <td>3</td>
      <td>ctrl + cï¼ˆé”®ç›˜æ“ä½œï¼‰</td>
      <td>ä¸­æ–­ç¨‹åº</td>
    </tr>
    <tr>
      <td>4</td>
      <td>b dict.c:dictAdd</td>
      <td>å¯¹åº”ä»£ç ä¸‹æ–­ç‚¹</td>
    </tr>
    <tr>
      <td>5</td>
      <td>c</td>
      <td>ç»§ç»­è¿è¡Œç¨‹åº</td>
    </tr>
    <tr>
      <td>6</td>
      <td>redis-cli<br />set k5 v5</td>
      <td>å¯åŠ¨ client è¿æ¥redis-serveræµ‹è¯•ï¼ˆredis é»˜è®¤ç«¯å£ 6379ï¼‰</td>
    </tr>
    <tr>
      <td>7</td>
      <td>focus</td>
      <td>è¿›å…¥æºç çª—å£è°ƒè¯•</td>
    </tr>
    <tr>
      <td>8</td>
      <td>bt</td>
      <td>ç¨‹åºå †æ ˆ(æŸ¥çœ‹æ¥å£è°ƒç”¨æµç¨‹)</td>
    </tr>
    <tr>
      <td>9</td>
      <td>f 0</td>
      <td>è¿›å…¥å †æ ˆç¬¬ 0 å±‚</td>
    </tr>
    <tr>
      <td>10</td>
      <td>n</td>
      <td>å•æ­¥è°ƒè¯•</td>
    </tr>
  </tbody>
</table>

<p><img src="/images/2020-02-20-16-51-07.png" alt="å‘½ä»¤çª—å£è°ƒè¯•" data-action="zoom" /></p>

<p><img src="/images/2020-02-20-16-51-21.png" alt="æºç çª—å£è°ƒè¯•" data-action="zoom" /></p>

<h2 id="5-vscode-è°ƒè¯•æµç¨‹">5. vscode è°ƒè¯•æµç¨‹</h2>

<h3 id="51-å¯åŠ¨-vscode">5.1. å¯åŠ¨ vscode</h3>

<p>å› ä¸º gdb åœ¨ macOS ä¸‹éœ€è¦ sudo æå‡æƒé™ï¼Œvscode é…ç½®è²Œä¼¼æ²¡æœ‰è¿™ä¸ªé€‰é¡¹è®¾ç½®ã€‚æ‰€ä»¥åªèƒ½ç”¨ä¸‹é¢è¿™ä¸ªå‘½ä»¤å¯åŠ¨ vscode é¡¹ç›®</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># redis æºç æœ¬åœ°ç›®å½•</span>
<span class="nb">cd</span> ~/src/other/redis-3.2.8

<span class="c">#  vscode æ‰“å¼€ redis æºç ç›®å½•</span>
<span class="nb">sudo </span>code <span class="nt">--user-data-dir</span><span class="o">=</span><span class="s2">"~/.vscode-root"</span> <span class="nb">.</span>
</code></pre></div></div>

<h3 id="52-vscode-é¡¹ç›®é…ç½®">5.2. vscode é¡¹ç›®é…ç½®</h3>

<ul>
  <li>launch.json</li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.2.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"configurations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gcc build and debug active file"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cppdbg"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="s2">"launch"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"program"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceFolder}/src/redis-server"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"redis.conf"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"stopAtEntry"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nl">"cwd"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceFolder}"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"environment"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
            </span><span class="nl">"externalConsole"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"MIMode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gdb"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"preLaunchTask"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>tasks.json</li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.0.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"tasks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/usr/bin/make"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="53-vscode-è°ƒè¯•">5.3. vscode è°ƒè¯•</h3>

<p><img src="/images/2020-02-20-16-51-48.png" alt="è°ƒè¯•" data-action="zoom" /></p>

<hr />

<h2 id="6-å‚è€ƒ">6. å‚è€ƒ</h2>

<ul>
  <li><a href="https://blog.csdn.net/men_wen/article/details/75220102">gdb è°ƒè¯•å·¥å…· â€” ä½¿ç”¨æ–¹æ³•æµ…æ</a></li>
  <li><a href="https://blog.csdn.net/suxinpingtao51/article/details/12072559">Linuxä¸­gdb æŸ¥çœ‹coreå †æ ˆä¿¡æ¯</a></li>
  <li><a href="https://www.jianshu.com/p/692d1cd27e9b">linuxä¸Šç”¨gdbè°ƒè¯•redisæºç </a></li>
</ul>

<hr />

<blockquote>
  <p>ğŸ”¥æ–‡ç« æ¥æºï¼š<a href="https://wenfh2020.com/">wenfh2020.com</a></p>
</blockquote>
