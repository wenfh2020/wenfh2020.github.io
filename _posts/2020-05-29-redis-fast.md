---
layout: post
title:  "redis ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«"
categories: redis
tags: redis fast
author: wenfh2020
mathjax: true
---

å¤©ä¸‹æ­¦åŠŸï¼Œå”¯å¿«ä¸ç ´ã€‚redis ä¸ºä»€ä¹ˆé‚£ä¹ˆå¿«ï¼Ÿredis å•è¿›ç¨‹å¹¶å‘ 10w+ ([hiredis + libev å¼‚æ­¥æµ‹è¯•](https://wenfh2020.com/2018/06/17/redis-hiredis-libev/))ã€‚æˆ‘ä»¬ä»è¿™å‡ ä¸ªè§’åº¦è¿›è¡Œåˆ†æï¼šå•è¿›ç¨‹ï¼Œå•çº¿ç¨‹ï¼Œå¤šçº¿ç¨‹ï¼Œå¤šè¿›ç¨‹ï¼Œå¤šå®ä¾‹ã€‚



* content
{:toc}

---

## 1. å•è¿›ç¨‹

redis æ ¸å¿ƒé€»è¾‘åœ¨å•è¿›ç¨‹ä¸»çº¿ç¨‹é‡Œå®ç°ã€‚

---

### 1.1. å•çº¿ç¨‹

* æ•°æ®å­˜å‚¨åœ¨å†…å­˜ã€‚

  > redis çš„åº”ç”¨åœºæ™¯ï¼Œä¸€èˆ¬ä½œä¸ºç¼“å­˜ï¼Œå®ƒçš„æ•°æ®å­˜å‚¨åœ¨å†…å­˜ï¼Œè€Œ cpu è®¿é—®å†…å­˜é€Ÿåº¦éå¸¸å¿«ã€‚

* å“ˆå¸Œè¡¨ã€‚
  
  > redis æ•°æ®åº“æ˜¯ Nosql æ•°æ®åº“ï¼Œå®ƒçš„æ•°æ®è®¿é—®æ¨¡å¼æ˜¯ `key - value`ï¼Œæ•°æ®ç´¢å¼•æ˜¯å“ˆå¸Œè¡¨ï¼Œæœç´¢æ•°æ®çš„æ—¶é—´å¤æ‚åº¦æ˜¯ $O(1)$ã€‚

* å¤šè·¯å¤ç”¨äº‹ä»¶å¼‚æ­¥ I/Oã€‚

  > redis è¿ç”¨äº† I/O å¤šè·¯å¤ç”¨æŠ€æœ¯å¯¹äº‹ä»¶è¿›è¡Œç®¡ç†ã€‚ä¾‹å¦‚ï¼šLinux ç”¨ `epoll`ã€‚

* éé˜»å¡ç½‘ç»œ I/Oã€‚

  > ä¸»é€»è¾‘åœ¨å•è¿›ç¨‹ï¼Œå•çº¿ç¨‹ï¼Œä¸èƒ½æœ‰é˜»å¡çš„ç¼“æ…¢æ“ä½œï¼Œæ‰€ä»¥ç½‘ç»œé€šä¿¡å¤§éƒ¨åˆ†è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ã€‚

---

> æœ‰çš„æœ‹å‹è¯´ï¼Œå•çº¿ç¨‹èŠ‚çœäº†é”å¸¦æ¥çš„å¼€é”€ï¼Œæˆ‘è®¤ä¸ºè¿™ä¹Ÿæ˜¯å…¶ä¸­ä¸€ä¸ªåŸå› ï¼Œä½†å®ƒå¹¶ä¸æ˜¯å¿«çš„ä¸»è¦åŸå› ã€‚
>
> å•çº¿ç¨‹å®ç°ä¸»é€»è¾‘æœ€ä¸»è¦ä½œç”¨ï¼Œæˆ‘è®¤ä¸ºæ˜¯é¿å…äº†é”å¸¦æ¥çš„å¤æ‚åº¦ï¼Œå‡å°‘äº†å‘ï¼Œä»è€ŒèŠ‚çœäº†äººåŠ›æˆæœ¬ã€‚å°½ç®¡è¿™æ ·ï¼Œåˆ©ç”¨å¤šæ ¸ä¼˜åŠ¿ï¼Œåœ¨å¤šçº¿ç¨‹ä¸­å®ç° key ç²’åº¦çš„è¯»å†™é”ï¼Œæˆ–è®¸æ˜¯æœªæ¥ redis éœ€è¦ä¼˜åŒ–å‘å±•çš„ä¸€ä¸ªè¶‹åŠ¿ã€‚

---

### 1.2. å¤šçº¿ç¨‹

redis æœ‰éƒ¨åˆ†åœºæ™¯éœ€è¦å­è¿›ç¨‹å’Œå­çº¿ç¨‹è¾…åŠ©ã€‚

* åå°å›æ”¶æ•°æ®çº¿ç¨‹ã€‚

  > redis æƒ°æ€§å¼‚æ­¥å›æ”¶æ•°æ®ã€‚å›æ”¶æ•°æ®é‡æ¯”è¾ƒå¤§çš„æ•°æ®é›†ï¼Œredis ä¼šé€šè¿‡åå°çº¿ç¨‹ï¼ˆ[bio](https://github.com/antirez/redis/blob/unstable/src/bio.c)ï¼‰è¿›è¡Œå›æ”¶ã€‚å…ˆä»å“ˆå¸Œè¡¨åˆ é™¤ keyï¼Œåˆ‡æ–­æ•°æ®ä¸ä¸»é€»è¾‘çš„è”ç³»ï¼Œå†æŠŠæ•°æ®ï¼ˆvalueï¼‰æ”¾è¿›åå°çº¿ç¨‹é‡Œå¼‚æ­¥å›æ”¶ã€‚è¿™æ ·ä¸å½±å“ä¸»çº¿ç¨‹ä¸»ä¸šåŠ¡çš„è¿è¡Œã€‚

* å¤šçº¿ç¨‹è¯»å†™é€šä¿¡ã€‚
  
  > redis 6.0 å¢åŠ å¤šçº¿ç¨‹è¯»å†™ç½‘ç»œäº‹ä»¶åŠŸèƒ½ã€‚[[redis æºç èµ°è¯»] å¤šçº¿ç¨‹é€šä¿¡ I/O](https://wenfh2020.com/2020/04/13/redis-multithreading-mode/)

---

## 2. å¤šè¿›ç¨‹

redis ä¸»æœåŠ¡æ˜¯å•è¿›ç¨‹çš„ã€‚å•è¿›ç¨‹ä¸èƒ½å……åˆ†åˆ©ç”¨ç³»ç»Ÿ cpu æ ¸å¿ƒã€‚å¯ä»¥é€šè¿‡å¤šå¼€å®ä¾‹æé«˜ç³»ç»Ÿçš„å¹¶å‘èƒ½åŠ›ã€‚

---

### 2.1. å­è¿›ç¨‹

redis æœ‰æŒä¹…åŒ–åŠŸèƒ½ï¼šaof å’Œ rdb æ–¹å¼ã€‚æŒä¹…åŒ–éœ€è¦å°†å†…å­˜æ•°æ®å†™å…¥ç£ç›˜ï¼Œå†™ç£ç›˜æ˜¯ç¼“æ…¢çš„ I/Oï¼Œä¸ºäº†é¿å…å½±å“ä¸»è¿›ç¨‹çš„æ€§èƒ½ï¼Œæœ‰äº›éœ€è¦å¯¹æ•´ä¸ªå†…å­˜æ•°æ®é›†è½åœ°çš„æ“ä½œï¼Œä¼šé€šè¿‡ fork å­è¿›ç¨‹è¿›è¡Œã€‚ä¾‹å¦‚ aof çš„ rewrite æ“ä½œï¼Œrdb æŒä¹…åŒ–ã€‚

---

### 2.2. å¤šå®ä¾‹

* ä¸»ä»å‰¯æœ¬ï¼ˆreplicationï¼‰ã€‚

  > ä¸»ä»å¤åˆ¶æ•°æ®ï¼Œä½¿å¾—æœåŠ¡æ•°æ®æœ‰å¤šä¸ªæ•°æ®å‰¯æœ¬ï¼Œå¯ä»¥è¿›è¡Œè¯»å†™åˆ†ç¦»ã€‚

* é«˜å¯ç”¨ã€‚

  > å¯ä»¥é€šè¿‡ sentinel å“¨å…µæ¨¡å¼ï¼Œredis cluster è‡ªå¸¦é›†ç¾¤æ¨¡å¼ï¼Œæˆ–è€…ç¬¬ä¸‰æ–¹ä»£ç†æ¨¡å¼å®ç° redis é«˜å¯ç”¨ã€‚

* proxy

  > redis å¯ä»¥å¼€å¤šä¸ªå®ä¾‹ï¼Œæé«˜ç³»ç»Ÿå¹¶å‘èƒ½åŠ›ï¼Œè¿™äº›å®ä¾‹é€šè¿‡ç¬¬ä¸‰æ–¹ä»£ç†ï¼ˆä¾‹å¦‚ [codis](https://github.com/CodisLabs/codis)ï¼‰è¿›è¡Œæ‰©å®¹ç¼©å®¹ï¼Œå¯¹æ•°æ®è¿›è¡Œåˆ†ç‰‡ç®¡ç†ã€‚

* redis cluster

  > redis è‡ªå¸¦é›†ç¾¤ cluster æ— ä¸­å¿ƒæ¶æ„ï¼Œé€šè¿‡ Gossip åè®®å°†å¤šä¸ªå®ä¾‹æ•°æ®åˆ†ç‰‡å»ºç«‹æˆä¸€ä¸ªæ•´ä½“ã€‚

---

> ğŸ”¥æ–‡ç« æ¥æºï¼š[wenfh2020.com](https://wenfh2020.com/)
