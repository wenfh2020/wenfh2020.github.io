I"n<p>redis çˆ¶å­è¿›ç¨‹é—´é€šè¿‡åŒ¿åç®¡é“è¿›è¡Œé€šä¿¡ã€‚redis aof æŒä¹…åŒ–ï¼Œé‡å†™åŠŸèƒ½ï¼Œé€šè¿‡å­è¿›ç¨‹å®ç°ï¼Œå­è¿›ç¨‹é‡å†™ aof æ–‡ä»¶è¿‡ç¨‹ä¸­ï¼Œå¦‚æœçˆ¶è¿›ç¨‹éœ€è¦æ›´æ–°æ•°æ®ï¼Œé‚£ä¹ˆçˆ¶å­è¿›ç¨‹é€šè¿‡åŒ¿åç®¡é“ä¼ è¾“æ–°æ•°æ®åˆ°å­è¿›ç¨‹è¿›è¡Œæ›´æ–°ã€‚</p>

<ul id="markdown-toc">
  <li><a href="#1-å•è¿›ç¨‹" id="markdown-toc-1-å•è¿›ç¨‹">1. å•è¿›ç¨‹</a></li>
  <li><a href="#2-å‚è€ƒ" id="markdown-toc-2-å‚è€ƒ">2. å‚è€ƒ</a></li>
</ul>

<hr />

<h2 id="1-å•è¿›ç¨‹">1. å•è¿›ç¨‹</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">feedAppendOnlyFile</span><span class="p">(</span><span class="k">struct</span> <span class="n">redisCommand</span> <span class="o">*</span><span class="n">cmd</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dictid</span><span class="p">,</span> <span class="n">robj</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="kt">int</span> <span class="n">argc</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="c1">// å¦‚æœæœ‰å­è¿›ç¨‹æ­£åœ¨é‡å†™ï¼Œçˆ¶è¿›ç¨‹å°†æ–°çš„æ•°æ®å‘é€ç»™æ­£åœ¨é‡å†™çš„å­è¿›ç¨‹ï¼Œä½¿å¾—é‡å†™æ–‡ä»¶æ•°æ®æ›´å®Œå¤‡ã€‚</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">server</span><span class="p">.</span><span class="n">aof_child_pid</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">aofRewriteBufferAppend</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">buf</span><span class="p">,</span><span class="n">sdslen</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="c1">// å°†æ•°æ®ä¿å­˜åˆ°é‡å†™ç¼“å†²åŒºé“¾è¡¨ã€‚ç„¶åé€šè¿‡çˆ¶å­è¿›ç¨‹ç®¡é“è¿›è¡Œæ•°æ®ä¼ è¾“</span>
<span class="kt">void</span> <span class="nf">aofRewriteBufferAppend</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">len</span><span class="p">)</span> <span class="p">{}</span>

<span class="c1">// çˆ¶è¿›ç¨‹é€šè¿‡ç®¡é“æŠŠé‡å†™ç¼“å†²åŒºæ•°æ®ï¼Œå‘é€åˆ°å­è¿›ç¨‹</span>
<span class="kt">void</span> <span class="nf">aofChildWriteDiffData</span><span class="p">(</span><span class="n">aeEventLoop</span> <span class="o">*</span><span class="n">el</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">privdata</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mask</span><span class="p">)</span> <span class="p">{}</span>

<span class="c1">// å­è¿›ç¨‹è¯»å–çˆ¶è¿›ç¨‹å‘é€çš„æ•°æ®ã€‚</span>
<span class="kt">ssize_t</span> <span class="nf">aofReadDiffFromParent</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{...}</span>

<span class="c1">// åˆ›å»ºçˆ¶å­è¿›ç¨‹é€šä¿¡ç®¡é“</span>
<span class="kt">int</span> <span class="nf">aofCreatePipes</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{...}</span>

<span class="c1">// çˆ¶å­ç»“æŸé€šä¿¡</span>
<span class="kt">void</span> <span class="nf">aofChildPipeReadable</span><span class="p">(</span><span class="n">aeEventLoop</span> <span class="o">*</span><span class="n">el</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">privdata</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mask</span><span class="p">)</span> <span class="p">{}</span>
</code></pre></div></div>

<hr />

<h2 id="2-å‚è€ƒ">2. å‚è€ƒ</h2>

<ul>
  <li><a href="https://blog.csdn.net/d_guco/article/details/53524854">å…±äº«å†…å­˜ï¼Œç®¡é“ï¼Œsocketç­‰è¿›ç¨‹é—´é€šä¿¡æ–¹å¼çš„ä¼˜ç¼ºç‚¹</a></li>
  <li><a href="https://blog.csdn.net/weixin_40039738/article/details/81095013">socketpairçš„ç”¨æ³•å’Œç†è§£</a></li>
  <li><a href="https://blog.csdn.net/W_J_F_/article/details/83789819">Linuxï¼šè¿›ç¨‹é—´é€šä¿¡ï¼ˆåŒ¿åç®¡é“å‘½åç®¡é“ï¼‰ï¼ˆå…±äº«å†…å­˜ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¿¡å·é‡ï¼‰</a></li>
</ul>

<hr />

<blockquote>
  <p>ğŸ”¥æ–‡ç« æ¥æºï¼š<a href="https://wenfh2020.com/">wenfh2020.com</a></p>
</blockquote>
:ET