I"¤U<p>æ•´æ•°é›†åˆï¼Œæ˜¯ä¸€ä¸ªæœ‰åºçš„æ•°å€¼æ•°ç»„å¯¹è±¡ï¼Œå­˜å‚¨çš„æ•°å€¼ä¸å…è®¸é‡å¤ã€‚æºç åœ¨ <code class="highlighter-rouge">intset.c</code></p>

<ul id="markdown-toc">
  <li><a href="#1-æ•°æ®ç»“æ„" id="markdown-toc-1-æ•°æ®ç»“æ„">1. æ•°æ®ç»“æ„</a></li>
  <li><a href="#2-æ¥å£" id="markdown-toc-2-æ¥å£">2. æ¥å£</a>    <ul>
      <li><a href="#21-æ•°å€¼ç¼–ç " id="markdown-toc-21-æ•°å€¼ç¼–ç ">2.1. æ•°å€¼ç¼–ç </a></li>
      <li><a href="#22-æ’å…¥æ•°æ®" id="markdown-toc-22-æ’å…¥æ•°æ®">2.2. æ’å…¥æ•°æ®</a></li>
      <li><a href="#23-å‡çº§" id="markdown-toc-23-å‡çº§">2.3. å‡çº§</a></li>
      <li><a href="#24-æœç´¢" id="markdown-toc-24-æœç´¢">2.4. æœç´¢</a></li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="1-æ•°æ®ç»“æ„">1. æ•°æ®ç»“æ„</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* Note that these encodings are ordered, so:
 * INTSET_ENC_INT16 &lt; INTSET_ENC_INT32 &lt; INTSET_ENC_INT64. */</span>
<span class="cp">#define INTSET_ENC_INT16 (sizeof(int16_t))
#define INTSET_ENC_INT32 (sizeof(int32_t))
#define INTSET_ENC_INT64 (sizeof(int64_t))
</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">intset</span> <span class="p">{</span>
    <span class="kt">uint32_t</span> <span class="n">encoding</span><span class="p">;</span> <span class="c1">// ç¼–ç ã€‚</span>
    <span class="kt">uint32_t</span> <span class="n">length</span><span class="p">;</span>   <span class="c1">// æ•°ç»„é•¿åº¦ã€‚</span>
    <span class="kt">int8_t</span> <span class="n">contents</span><span class="p">[];</span> <span class="c1">// æ•´æ•°å€¼æ•°å€¼ã€‚</span>
<span class="p">}</span> <span class="n">intset</span><span class="p">;</span>
</code></pre></div></div>

<p>æ ¹æ®æ’å…¥æ•°å€¼å¤§å°ï¼Œå†³å®š <code class="highlighter-rouge">contents</code> æ•°ç»„çš„<code class="highlighter-rouge">encoding</code>æ ¼å¼ã€‚ç¼–ç æ ¼å¼åˆ†åˆ«æœ‰ <code class="highlighter-rouge">int16_t</code>ï¼Œ<code class="highlighter-rouge">int32_t</code>ï¼Œ<code class="highlighter-rouge">int64_t</code>ã€‚ä»¥æœ€å¤§çš„æ•°å€¼ä¸ºå‡†ï¼Œå¦‚æœæœ€å¤§çš„æ•°å€¼æ˜¯ <code class="highlighter-rouge">int64_t</code> é‚£ä¹ˆæ•°ç»„çš„æ¯ä¸ª <code class="highlighter-rouge">item</code> éƒ½æ˜¯ <code class="highlighter-rouge">int64_t</code>ï¼Œä¼˜ç‚¹æ˜¯ç»Ÿä¸€ç®€å•ï¼Œæé«˜æ•°ç»„æŸ¥æ‰¾æ•ˆç‡â€”â€”æºç å®ç°æ˜¯é€šè¿‡äºŒåˆ†æ³•æŸ¥æ‰¾ã€‚å¦‚æœæ•°ç»„ä¸åŒæ•°å€¼ç”¨ä¸åŒçš„ç¼–ç å­˜å‚¨ï¼Œå°±å¾ˆéš¾ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾äº†ã€‚
ä½†æ˜¯è¿™æ ·åšä¸€æ–¹é¢æé«˜äº†æŸ¥æ‰¾æ•ˆç‡ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿä¼šå¯¼è‡´å†…å­˜æµªè´¹ï¼Œå¦‚æœæ‰€æœ‰æ•°æ®ä¸­ï¼Œåªæœ‰ä¸€ä¸ªæ•°æ®æ˜¯ <code class="highlighter-rouge">int64_t</code>ï¼Œå…¶å®ƒæ•°æ®éƒ½æ˜¯ <code class="highlighter-rouge">int16_t</code>ï¼Œæ•´ä¸ªæ•°ç»„ <code class="highlighter-rouge">item</code> éƒ½ä»¥ <code class="highlighter-rouge">int64_t</code> å­˜å‚¨ï¼Œæ˜¾ç„¶ä¼šé€ æˆå†…å­˜æµªè´¹ã€‚
å½“ç„¶ redis çš„æ•°æ®ç»“æ„æ˜¯ä¸°å¯Œçš„ï¼Œè¿ç»­å†…å­˜ä¸Šçš„æ•°æ®ç®¡ç†æœ‰ï¼šå­—ç¬¦ä¸²å¯¹è±¡ï¼ˆsdsï¼‰ï¼Œå‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰ï¼Œè¿™é‡Œæœ‰æ•´æ•°é›†åˆï¼ˆintsetï¼‰ï¼Œéƒ½åˆ†åˆ«é’ˆå¯¹ä¸åŒçš„åº”ç”¨åœºæ™¯è¿›è¡Œåº”ç”¨ã€‚</p>

<hr />

<h2 id="2-æ¥å£">2. æ¥å£</h2>

<h3 id="21-æ•°å€¼ç¼–ç ">2.1. æ•°å€¼ç¼–ç </h3>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define INT8_MAX         127
#define INT16_MAX        32767
#define INT32_MAX        2147483647
#define INT64_MAX        9223372036854775807LL
</span>
<span class="cp">#define INT8_MIN          -128
#define INT16_MIN         -32768
</span>
<span class="cm">/* Return the required encoding for the provided value. */</span>
<span class="k">static</span> <span class="kt">uint8_t</span> <span class="nf">_intsetValueEncoding</span><span class="p">(</span><span class="kt">int64_t</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&lt;</span> <span class="n">INT32_MIN</span> <span class="o">||</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="n">INT32_MAX</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">INTSET_ENC_INT64</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&lt;</span> <span class="n">INT16_MIN</span> <span class="o">||</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="n">INT16_MAX</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">INTSET_ENC_INT32</span><span class="p">;</span>
    <span class="k">else</span>
        <span class="k">return</span> <span class="n">INTSET_ENC_INT16</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<h3 id="22-æ’å…¥æ•°æ®">2.2. æ’å…¥æ•°æ®</h3>

<p>æ£€æŸ¥æ’å…¥æ•°æ®æ˜¯å¦å¤§äºå½“å‰ç¼–ç æ ¼å¼ï¼Œå†³å®šæ˜¯å¦éœ€è¦å‡çº§</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* Insert an integer in the intset */</span>
<span class="n">intset</span> <span class="o">*</span><span class="nf">intsetAdd</span><span class="p">(</span><span class="n">intset</span> <span class="o">*</span><span class="n">is</span><span class="p">,</span> <span class="kt">int64_t</span> <span class="n">value</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">success</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">uint8_t</span> <span class="n">valenc</span> <span class="o">=</span> <span class="n">_intsetValueEncoding</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
    <span class="kt">uint32_t</span> <span class="n">pos</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">success</span><span class="p">)</span> <span class="o">*</span><span class="n">success</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="cm">/* Upgrade encoding if necessary. If we need to upgrade, we know that
     * this value should be either appended (if &gt; 0) or prepended (if &lt; 0),
     * because it lies outside the range of existing values. */</span>
    <span class="c1">// å¦‚æœæ’å…¥æ•°å€¼å¤§äºå½“å‰ç¼–ç ï¼Œé‚£ä¹ˆéœ€è¦å‡çº§æ•°ç»„</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">valenc</span> <span class="o">&gt;</span> <span class="n">intrev32ifbe</span><span class="p">(</span><span class="n">is</span><span class="o">-&gt;</span><span class="n">encoding</span><span class="p">))</span> <span class="p">{</span>
        <span class="cm">/* This always succeeds, so we don't need to curry *success. */</span>
        <span class="k">return</span> <span class="n">intsetUpgradeAndAdd</span><span class="p">(</span><span class="n">is</span><span class="p">,</span><span class="n">value</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="cm">/* Abort if the value is already present in the set.
         * This call will populate "pos" with the right position to insert
         * the value when it cannot be found. */</span>
        <span class="c1">// å¦‚æœæ•°å€¼å·²ç»å­˜åœ¨ï¼Œå°±ä¸éœ€è¦æ’å…¥æ•°æ®äº†ã€‚*success = 0;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">intsetSearch</span><span class="p">(</span><span class="n">is</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="o">&amp;</span><span class="n">pos</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">success</span><span class="p">)</span> <span class="o">*</span><span class="n">success</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">is</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// æ•°æ®å¢é•¿ï¼Œé‡æ–°ç”³è¯·å†…å­˜ã€‚</span>
        <span class="n">is</span> <span class="o">=</span> <span class="n">intsetResize</span><span class="p">(</span><span class="n">is</span><span class="p">,</span><span class="n">intrev32ifbe</span><span class="p">(</span><span class="n">is</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&lt;</span> <span class="n">intrev32ifbe</span><span class="p">(</span><span class="n">is</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">))</span> <span class="n">intsetMoveTail</span><span class="p">(</span><span class="n">is</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">_intsetSet</span><span class="p">(</span><span class="n">is</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">value</span><span class="p">);</span>
    <span class="n">is</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">=</span> <span class="n">intrev32ifbe</span><span class="p">(</span><span class="n">intrev32ifbe</span><span class="p">(</span><span class="n">is</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">is</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="23-å‡çº§">2.3. å‡çº§</h3>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* Upgrades the intset to a larger encoding and inserts the given integer. */</span>
<span class="k">static</span> <span class="n">intset</span> <span class="o">*</span><span class="nf">intsetUpgradeAndAdd</span><span class="p">(</span><span class="n">intset</span> <span class="o">*</span><span class="n">is</span><span class="p">,</span> <span class="kt">int64_t</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">uint8_t</span> <span class="n">curenc</span> <span class="o">=</span> <span class="n">intrev32ifbe</span><span class="p">(</span><span class="n">is</span><span class="o">-&gt;</span><span class="n">encoding</span><span class="p">);</span>
    <span class="kt">uint8_t</span> <span class="n">newenc</span> <span class="o">=</span> <span class="n">_intsetValueEncoding</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="n">intrev32ifbe</span><span class="p">(</span><span class="n">is</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">);</span>

    <span class="c1">// å› ä¸ºæ’å…¥æ–°çš„æ•°æ®ï¼Œè€Œä¸”æ•°æ®è¶…å‡ºäº†å½“å‰æ•°ç»„æ‰€æœ‰æ•°å€¼çš„èŒƒå›´æ‰ä¼šå‡çº§ã€‚</span>
    <span class="c1">// è¶…å‡ºäº†è´Ÿæ•°ï¼Œæˆ–è€…è¶…å‡ºäº†æ­£æ•°ã€‚æ­£æ•°åœ¨æ•°ç»„æœ«æ·»åŠ ï¼Œè´Ÿæ•°åœ¨æ•°ç»„å‰é¢æ·»åŠ ã€‚</span>
    <span class="kt">int</span> <span class="n">prepend</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>

    <span class="cm">/* First set new encoding and resize */</span>
    <span class="n">is</span><span class="o">-&gt;</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">intrev32ifbe</span><span class="p">(</span><span class="n">newenc</span><span class="p">);</span>
    <span class="n">is</span> <span class="o">=</span> <span class="n">intsetResize</span><span class="p">(</span><span class="n">is</span><span class="p">,</span><span class="n">intrev32ifbe</span><span class="p">(</span><span class="n">is</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>

    <span class="cm">/* Upgrade back-to-front so we don't overwrite values.
     * Note that the "prepend" variable is used to make sure we have an empty
     * space at either the beginning or the end of the intset. */</span>
    <span class="c1">// æ‰©å……å†…å­˜åï¼Œè¿ç§»æ•°æ®ã€‚</span>
    <span class="k">while</span><span class="p">(</span><span class="n">length</span><span class="o">--</span><span class="p">)</span>
        <span class="n">_intsetSet</span><span class="p">(</span><span class="n">is</span><span class="p">,</span><span class="n">length</span><span class="o">+</span><span class="n">prepend</span><span class="p">,</span><span class="n">_intsetGetEncoded</span><span class="p">(</span><span class="n">is</span><span class="p">,</span><span class="n">length</span><span class="p">,</span><span class="n">curenc</span><span class="p">));</span>

    <span class="cm">/* Set the value at the beginning or the end. */</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">prepend</span><span class="p">)</span>
        <span class="n">_intsetSet</span><span class="p">(</span><span class="n">is</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">value</span><span class="p">);</span>
    <span class="k">else</span>
        <span class="n">_intsetSet</span><span class="p">(</span><span class="n">is</span><span class="p">,</span><span class="n">intrev32ifbe</span><span class="p">(</span><span class="n">is</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">),</span><span class="n">value</span><span class="p">);</span>
    <span class="n">is</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">=</span> <span class="n">intrev32ifbe</span><span class="p">(</span><span class="n">intrev32ifbe</span><span class="p">(</span><span class="n">is</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">is</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/images/2020-02-20-16-39-40.png" alt="å‡çº§" data-action="zoom" /></p>

<h3 id="24-æœç´¢">2.4. æœç´¢</h3>

<p>äºŒåˆ†æ³•æœç´¢æ•°ç»„æ•°æ®ã€‚</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* Search for the position of "value". Return 1 when the value was found and
 * sets "pos" to the position of the value within the intset. Return 0 when
 * the value is not present in the intset and sets "pos" to the position
 * where "value" can be inserted. */</span>
<span class="k">static</span> <span class="kt">uint8_t</span> <span class="nf">intsetSearch</span><span class="p">(</span><span class="n">intset</span> <span class="o">*</span><span class="n">is</span><span class="p">,</span> <span class="kt">int64_t</span> <span class="n">value</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">pos</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">min</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">max</span> <span class="o">=</span> <span class="n">intrev32ifbe</span><span class="p">(</span><span class="n">is</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">mid</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="kt">int64_t</span> <span class="n">cur</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

    <span class="cm">/* The value can never be found when the set is empty */</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">intrev32ifbe</span><span class="p">(</span><span class="n">is</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">*</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// æ£€æŸ¥æ•°å€¼æ˜¯å¦å¤§äºæˆ–å°äºæ•°ç»„é‡Œçš„æ‰€æœ‰æ•°å€¼ã€‚</span>
        <span class="cm">/* Check for the case where we know we cannot find the value,
         * but do know the insert position. */</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">&gt;</span> <span class="n">_intsetGet</span><span class="p">(</span><span class="n">is</span><span class="p">,</span><span class="n">max</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">*</span><span class="n">pos</span> <span class="o">=</span> <span class="n">intrev32ifbe</span><span class="p">(</span><span class="n">is</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">);</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">&lt;</span> <span class="n">_intsetGet</span><span class="p">(</span><span class="n">is</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">*</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// æ•°å€¼å¦‚æœåœ¨å­˜å‚¨çš„æ•°æ®ä¸­é—´ï¼Œç”¨äºŒåˆ†æ³•æŸ¥æ‰¾ã€‚</span>
    <span class="k">while</span><span class="p">(</span><span class="n">max</span> <span class="o">&gt;=</span> <span class="n">min</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">min</span> <span class="o">+</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">max</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">_intsetGet</span><span class="p">(</span><span class="n">is</span><span class="p">,</span><span class="n">mid</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">&gt;</span> <span class="n">cur</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">min</span> <span class="o">=</span> <span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">&lt;</span> <span class="n">cur</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">max</span> <span class="o">=</span> <span class="n">mid</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="n">cur</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">*</span><span class="n">pos</span> <span class="o">=</span> <span class="n">mid</span><span class="p">;</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">*</span><span class="n">pos</span> <span class="o">=</span> <span class="n">min</span><span class="p">;</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
:ET