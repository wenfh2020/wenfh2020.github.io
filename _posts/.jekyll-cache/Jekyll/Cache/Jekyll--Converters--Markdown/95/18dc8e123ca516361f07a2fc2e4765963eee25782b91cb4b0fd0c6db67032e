I"P8<p>è‡ªåŠ¨ä»£ç å·¥å…·ï¼Œæ ¹æ® sql è„šæœ¬çš„è¯­æ³•ç‰¹å¾ï¼Œæå–è„šæœ¬çš„è¡¨åï¼ˆtable nameï¼‰å’Œå…¶å¯¹åº”çš„åˆ—ï¼ˆcolumnï¼‰ä¿¡æ¯ï¼ŒæŠ½è±¡æˆç±»ï¼Œå¹¶ç”Ÿæˆå¯¹åº”çš„ C++ æºç æ–‡ä»¶ã€‚</p>

<ul id="markdown-toc">
  <li><a href="#1-å·¥å…·ä½œç”¨" id="markdown-toc-1-å·¥å…·ä½œç”¨">1. å·¥å…·ä½œç”¨</a></li>
  <li><a href="#2-ä½¿ç”¨" id="markdown-toc-2-ä½¿ç”¨">2. ä½¿ç”¨</a></li>
</ul>

<hr />

<h2 id="1-å·¥å…·ä½œç”¨">1. å·¥å…·ä½œç”¨</h2>

<p>è‡ªåŠ¨ä»£ç å·¥å…·ä½œç”¨ï¼Œç±»ä¼¼ protobuf é€šè¿‡ *.proto æ–‡ä»¶ï¼Œç”¨å·¥å…·ç”Ÿæˆç›¸åº”çš„æºç æ–‡ä»¶ã€‚</p>

<ol>
  <li>ç›´æ¥å‡å°‘äº†å›¢é˜Ÿå¼€å‘å·¥ä½œé‡ã€‚</li>
  <li>æœ‰åˆ©äºå›¢é˜Ÿä»£ç é£æ ¼ç»Ÿä¸€ã€‚</li>
  <li>æ•°æ®æ“ä½œé¢å‘å¯¹è±¡ï¼Œæ“ä½œäººæ€§åŒ–ã€‚</li>
</ol>

<hr />

<h2 id="2-ä½¿ç”¨">2. ä½¿ç”¨</h2>

<p>æºç å·²ä¸Šä¼  <a href="https://github.com/wenfh2020/db_gencode">github</a>ã€‚</p>

<ul>
  <li>å‘½ä»¤</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./db_gencode &lt;file_name&gt;
</code></pre></div></div>

<ul>
  <li>ç¼–è¯‘æºç ä½¿ç”¨ã€‚</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/wenfh2020/db_gencode.git
<span class="nb">cd </span>db_gencode
make
./db_gencode upload.sql
</code></pre></div></div>

<ul>
  <li>è„šæœ¬ï¼ˆupload.sqlï¼‰ã€‚</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- MySQL dump 10.13  Distrib 5.7.22, for Linux (x86_64)</span>
<span class="c1">--</span>
<span class="c1">-- Host: localhost    Database: upload</span>
<span class="c1">-- ------------------------------------------------------</span>
<span class="c1">-- Server version   5.7.22</span>

<span class="c1">--</span>
<span class="c1">-- Table structure for table `tb_file`</span>
<span class="c1">--</span>

<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="nv">`tb_file`</span><span class="p">;</span>
<span class="cm">/*!40101 SET @saved_cs_client     = @@character_set_client */</span><span class="p">;</span>
<span class="cm">/*!40101 SET character_set_client = utf8 */</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`tb_file`</span> <span class="p">(</span>
  <span class="nv">`id`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="nv">`file_name`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`file_size`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">'0'</span><span class="p">,</span>
  <span class="nv">`md5`</span> <span class="nb">char</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">''</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">),</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">MyISAM</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">55688</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
</code></pre></div></div>

<ul>
  <li>c++ æºç æ–‡ä»¶(*.h/*.cpp)ã€‚</li>
</ul>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// tb_file.h</span>
<span class="k">class</span> <span class="nc">tb_file</span> <span class="p">{</span>
<span class="nl">public:</span>
    <span class="n">tb_file</span><span class="p">();</span>
    <span class="n">tb_file</span><span class="p">(</span><span class="k">const</span> <span class="n">tb_file</span><span class="o">&amp;</span> <span class="n">obj</span><span class="p">);</span>
    <span class="o">~</span><span class="n">tb_file</span><span class="p">()</span> <span class="p">{}</span>

    <span class="n">tb_file</span><span class="o">&amp;</span> <span class="k">operator</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="n">tb_file</span><span class="o">&amp;</span> <span class="n">obj</span><span class="p">);</span>

    <span class="kr">inline</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">table_name</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="s">"tb_file"</span><span class="p">;</span> <span class="p">}</span>
    <span class="kr">inline</span> <span class="n">tb_uint32</span> <span class="n">get_count</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">4</span><span class="p">;</span> <span class="p">}</span>
    <span class="n">string</span> <span class="n">serialize</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

    <span class="kr">inline</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">col_id</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="s">"`id`"</span><span class="p">;</span> <span class="p">}</span>
    <span class="kr">inline</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">col_file_name</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="s">"`file_name`"</span><span class="p">;</span> <span class="p">}</span>
    <span class="kr">inline</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">col_file_size</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="s">"`file_size`"</span><span class="p">;</span> <span class="p">}</span>
    <span class="kr">inline</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">col_md5</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="s">"`md5`"</span><span class="p">;</span> <span class="p">}</span>

    <span class="kt">bool</span> <span class="n">set_id</span><span class="p">(</span><span class="k">const</span> <span class="n">tb_uint32</span> <span class="n">value</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">set_file_name</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">set_file_name</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">value</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">set_file_name</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">value</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">set_file_size</span><span class="p">(</span><span class="k">const</span> <span class="n">tb_int32</span> <span class="n">value</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">set_md5</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">set_md5</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">value</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">);</span>
    <span class="kt">bool</span> <span class="n">set_md5</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">value</span><span class="p">);</span>

    <span class="kr">inline</span> <span class="n">tb_uint32</span> <span class="n">id</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_ui_id</span><span class="p">;</span> <span class="p">}</span>
    <span class="kr">inline</span> <span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">file_name</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_str_file_name</span><span class="p">;</span> <span class="p">}</span>
    <span class="kr">inline</span> <span class="n">tb_int32</span> <span class="n">file_size</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_i_file_size</span><span class="p">;</span> <span class="p">}</span>
    <span class="kr">inline</span> <span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">md5</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_str_md5</span><span class="p">;</span> <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">bool</span> <span class="n">has_id</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">m_ui_has_bit</span> <span class="o">&amp;</span> <span class="mh">0x00000001</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
    <span class="kr">inline</span> <span class="kt">bool</span> <span class="n">has_file_name</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">m_ui_has_bit</span> <span class="o">&amp;</span> <span class="mh">0x00000002</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
    <span class="kr">inline</span> <span class="kt">bool</span> <span class="n">has_file_size</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">m_ui_has_bit</span> <span class="o">&amp;</span> <span class="mh">0x00000004</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
    <span class="kr">inline</span> <span class="kt">bool</span> <span class="n">has_md5</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">m_ui_has_bit</span> <span class="o">&amp;</span> <span class="mh">0x00000008</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">clear_has_id</span><span class="p">()</span> <span class="p">{</span> <span class="n">m_ui_has_bit</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x00000001</span><span class="p">;</span> <span class="p">}</span>
    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">clear_has_file_name</span><span class="p">()</span> <span class="p">{</span> <span class="n">m_ui_has_bit</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x00000002</span><span class="p">;</span> <span class="p">}</span>
    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">clear_has_file_size</span><span class="p">()</span> <span class="p">{</span> <span class="n">m_ui_has_bit</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x00000004</span><span class="p">;</span> <span class="p">}</span>
    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">clear_has_md5</span><span class="p">()</span> <span class="p">{</span> <span class="n">m_ui_has_bit</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x00000008</span><span class="p">;</span> <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">bool</span> <span class="n">is_valid</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="p">(</span><span class="n">m_ui_has_bit</span> <span class="o">&amp;</span> <span class="mh">0x0000000f</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;}</span>

<span class="nl">private:</span>
    <span class="n">tb_uint32</span> <span class="n">m_ui_has_bit</span><span class="p">;</span>
    <span class="n">tb_uint32</span> <span class="n">m_ui_id</span><span class="p">;</span>
    <span class="n">string</span> <span class="n">m_str_file_name</span><span class="p">;</span>
    <span class="n">tb_int32</span> <span class="n">m_i_file_size</span><span class="p">;</span>
    <span class="n">string</span> <span class="n">m_str_md5</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<hr />

<blockquote>
  <p>ğŸ”¥æ–‡ç« æ¥æºï¼š<a href="https://wenfh2020.com/2020/06/04/mysql-db-gencode/">wenfh2020.com</a></p>
</blockquote>
:ET