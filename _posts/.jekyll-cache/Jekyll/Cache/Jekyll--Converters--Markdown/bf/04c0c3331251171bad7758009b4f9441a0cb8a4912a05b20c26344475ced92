I".W<p>ç†è§£ libev å·¥ä½œæµç¨‹ï¼Œ<a href="http://pod.tst.eu/http://cvs.schmorp.de/libev/ev.pod#code_ev_timer_code_relative_and_opti">å®˜æ–¹æ–‡æ¡£</a> å’Œç½‘ä¸Šæœ‰å¾ˆå¤šèµ„æ–™å¯ä»¥æŸ¥é˜…ï¼ˆ<a href="https://my.oschina.net/u/917596/blog/176658">äº‹ä»¶åº“ä¹‹Libevï¼ˆä¸€ï¼‰</a>ï¼Œ<a href="https://www.cnblogs.com/gqtcgq/category/1043758.html">éšç¬”åˆ†ç±» - libev</a>ï¼‰ã€‚libev æºç ï¼Œå®çš„ä½¿ç”¨é¢‘ç‡æ¯”è¾ƒé«˜ï¼Œä¹Ÿå› ä¸ºè¿™æ ·ï¼Œæºç ç†è§£èµ·æ¥æ¯”è¾ƒè´¹è„‘ï¼Œå¯ä»¥å±•å¼€å®æŸ¥é˜…æºç ï¼Œæˆ–è€…é€šè¿‡è°ƒè¯•æ–¹å¼ï¼Œç†è§£ libev çš„å·¥ä½œæµç¨‹ã€‚redis-ae äº‹ä»¶ç®¡ç†ä¸ libev æœ‰ç‚¹ç±»ä¼¼ï¼Œä¹Ÿå¯ä»¥ç›¸äº’æ¯”è¾ƒä¸€ä¸‹ã€‚</p>

<ul id="markdown-toc">
  <li><a href="#1-å±•å¼€å®" id="markdown-toc-1-å±•å¼€å®">1. å±•å¼€å®</a></li>
  <li><a href="#2-gdb-è°ƒè¯•" id="markdown-toc-2-gdb-è°ƒè¯•">2. gdb è°ƒè¯•</a></li>
  <li><a href="#3-å¯¹æ¯”-redis-ae" id="markdown-toc-3-å¯¹æ¯”-redis-ae">3. å¯¹æ¯” redis-ae</a></li>
  <li><a href="#4-å‚è€ƒ" id="markdown-toc-4-å‚è€ƒ">4. å‚è€ƒ</a></li>
</ul>

<hr />

<h2 id="1-å±•å¼€å®">1. å±•å¼€å®</h2>

<p>ç¨‹åºç¼–è¯‘æµç¨‹ï¼šé¢„ç¼–è¯‘ï¼Œç¼–è¯‘ï¼Œæ±‡ç¼–å™¨ï¼Œé“¾æ¥ã€‚é¢„ç¼–è¯‘é˜¶æ®µï¼Œè¿˜æ²¡æ¶‰åŠç¨‹åºè¯­ä¹‰è§£æï¼Œå¯ä»¥å°†æ–‡ä»¶çš„å®è¿›è¡Œå±•å¼€ã€‚</p>

<p>libev æ ¸å¿ƒé€»è¾‘åœ¨ <code class="highlighter-rouge">ev.c</code> æ–‡ä»¶ï¼Œå¯¹è¿™ä¸ªæ–‡ä»¶è¿›è¡Œé¢„ç¼–è¯‘ï¼ˆå…¶å®ƒæ–‡ä»¶ä¹Ÿå¯ä»¥å‚è€ƒè¿™ä¸ªæ–¹æ³•ï¼‰ã€‚</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcc <span class="nt">-E</span> ev.c <span class="nt">-o</span> ev.i
</code></pre></div></div>

<ul>
  <li>å®å±•å¼€å‰</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ev.c</span>
<span class="kt">void</span> <span class="n">noinline</span>
<span class="n">ev_timer_start</span> <span class="p">(</span><span class="n">EV_P_</span> <span class="n">ev_timer</span> <span class="o">*</span><span class="n">w</span><span class="p">)</span> <span class="n">EV_THROW</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">expect_false</span> <span class="p">(</span><span class="n">ev_is_active</span> <span class="p">(</span><span class="n">w</span><span class="p">)))</span>
    <span class="k">return</span><span class="p">;</span>

  <span class="n">ev_at</span> <span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">+=</span> <span class="n">mn_now</span><span class="p">;</span>

  <span class="n">assert</span> <span class="p">((</span><span class="s">"libev: ev_timer_start called with negative timer repeat value"</span><span class="p">,</span> <span class="n">w</span><span class="o">-&gt;</span><span class="n">repeat</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">.));</span>

  <span class="n">EV_FREQUENT_CHECK</span><span class="p">;</span>

  <span class="o">++</span><span class="n">timercnt</span><span class="p">;</span>
  <span class="n">ev_start</span> <span class="p">(</span><span class="n">EV_A_</span> <span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="n">w</span><span class="p">,</span> <span class="n">timercnt</span> <span class="o">+</span> <span class="n">HEAP0</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">array_needsize</span> <span class="p">(</span><span class="n">ANHE</span><span class="p">,</span> <span class="n">timers</span><span class="p">,</span> <span class="n">timermax</span><span class="p">,</span> <span class="n">ev_active</span> <span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">EMPTY2</span><span class="p">);</span>
  <span class="n">ANHE_w</span> <span class="p">(</span><span class="n">timers</span> <span class="p">[</span><span class="n">ev_active</span> <span class="p">(</span><span class="n">w</span><span class="p">)])</span> <span class="o">=</span> <span class="p">(</span><span class="n">WT</span><span class="p">)</span><span class="n">w</span><span class="p">;</span>
  <span class="n">ANHE_at_cache</span> <span class="p">(</span><span class="n">timers</span> <span class="p">[</span><span class="n">ev_active</span> <span class="p">(</span><span class="n">w</span><span class="p">)]);</span>
  <span class="n">upheap</span> <span class="p">(</span><span class="n">timers</span><span class="p">,</span> <span class="n">ev_active</span> <span class="p">(</span><span class="n">w</span><span class="p">));</span>

  <span class="n">EV_FREQUENT_CHECK</span><span class="p">;</span>

  <span class="cm">/*assert (("libev: internal timer heap corruption", timers [ev_active (w)] == (WT)w));*/</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>å®å±•å¼€å</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ev.i</span>
<span class="kt">void</span> <span class="nf">__attribute__</span> <span class="p">((</span><span class="n">__noinline__</span><span class="p">))</span>
<span class="n">ev_timer_start</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ev_loop</span> <span class="o">*</span><span class="n">loop</span><span class="p">,</span> <span class="n">ev_timer</span> <span class="o">*</span><span class="n">w</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">__builtin_expect</span> <span class="p">((</span><span class="o">!!</span><span class="p">((</span><span class="mi">0</span> <span class="o">+</span> <span class="p">((</span><span class="n">ev_watcher</span> <span class="o">*</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)(</span><span class="n">w</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">active</span><span class="p">))),(</span><span class="mi">0</span><span class="p">)))</span>
    <span class="k">return</span><span class="p">;</span>

  <span class="p">((</span><span class="n">WT</span><span class="p">)(</span><span class="n">w</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">at</span> <span class="o">+=</span> <span class="p">((</span><span class="n">loop</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">mn_now</span><span class="p">);</span>
  <span class="p">...</span>
  <span class="k">do</span> <span class="p">{</span> <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="mi">0</span><span class="p">);</span>

  <span class="o">++</span><span class="p">((</span><span class="n">loop</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">timercnt</span><span class="p">);</span>
  <span class="n">ev_start</span> <span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="n">w</span><span class="p">,</span> <span class="p">((</span><span class="n">loop</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">timercnt</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">__builtin_expect</span> <span class="p">((</span><span class="o">!!</span><span class="p">((((</span><span class="n">W</span><span class="p">)(</span><span class="n">w</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">active</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(((</span><span class="n">loop</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">timermax</span><span class="p">)))),(</span><span class="mi">0</span><span class="p">)))</span> <span class="p">{</span> <span class="kt">int</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__unused__</span><span class="p">))</span> <span class="n">ocur_</span> <span class="o">=</span> <span class="p">(((</span><span class="n">loop</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">timermax</span><span class="p">));</span> <span class="p">(((</span><span class="n">loop</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">timers</span><span class="p">))</span> <span class="o">=</span> <span class="p">(</span><span class="n">ANHE</span> <span class="o">*</span><span class="p">)</span><span class="n">array_realloc</span> <span class="p">(</span><span class="k">sizeof</span> <span class="p">(</span><span class="n">ANHE</span><span class="p">),</span> <span class="p">(((</span><span class="n">loop</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">timers</span><span class="p">)),</span> <span class="o">&amp;</span><span class="p">(((</span><span class="n">loop</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">timermax</span><span class="p">)),</span> <span class="p">(((</span><span class="n">W</span><span class="p">)(</span><span class="n">w</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">active</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span> <span class="p">;</span> <span class="p">};</span>
  <span class="p">(((</span><span class="n">loop</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">timers</span><span class="p">)</span> <span class="p">[((</span><span class="n">W</span><span class="p">)(</span><span class="n">w</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">active</span><span class="p">]).</span><span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="n">WT</span><span class="p">)</span><span class="n">w</span><span class="p">;</span>
  <span class="p">(((</span><span class="n">loop</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">timers</span><span class="p">)</span> <span class="p">[((</span><span class="n">W</span><span class="p">)(</span><span class="n">w</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">active</span><span class="p">]).</span><span class="n">at</span> <span class="o">=</span> <span class="p">(((</span><span class="n">loop</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">timers</span><span class="p">)</span> <span class="p">[((</span><span class="n">W</span><span class="p">)(</span><span class="n">w</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">active</span><span class="p">]).</span><span class="n">w</span><span class="o">-&gt;</span><span class="n">at</span><span class="p">;</span>
  <span class="n">upheap</span> <span class="p">(((</span><span class="n">loop</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">timers</span><span class="p">),</span> <span class="p">((</span><span class="n">W</span><span class="p">)(</span><span class="n">w</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">active</span><span class="p">);</span>

  <span class="k">do</span> <span class="p">{</span> <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<h2 id="2-gdb-è°ƒè¯•">2. gdb è°ƒè¯•</h2>

<ol>
  <li>ä¸‹è½½ libev æºç ï¼š<a href="http://dist.schmorp.de/libev/">æºç åœ°å€</a></li>
  <li>ä¿®æ”¹æºç ç›®å½•ä¸‹çš„ configure æ–‡ä»¶ï¼Œå°†æ‰€æœ‰ç¼–è¯‘ä¼˜åŒ–é¡¹ï¼ˆCFLAGSï¼‰ï¼Œä¿®æ”¹ä¸º CFLAGS=â€-g O0â€ã€‚</li>
  <li>ç¼–è¯‘å®‰è£…æºç ï¼š./configure &amp;&amp; make &amp;&amp; make install</li>
  <li>gdb è°ƒè¯•æµ‹è¯•æºç ã€‚</li>
</ol>

<blockquote>
  <p>è¯¦ç»†è¯·å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1U54y1D7uM/">gdb &amp; libev è°ƒè¯•è§†é¢‘</a></p>
</blockquote>

<p><img src="/images/2020-05-28-21-04-53.png" alt="libev è°ƒè¯•" data-action="zoom" /></p>

<hr />

<h2 id="3-å¯¹æ¯”-redis-ae">3. å¯¹æ¯” redis-ae</h2>

<p>redis äº‹ä»¶ç®¡ç† <code class="highlighter-rouge">aeEventLoop</code> ä¸ libev ç±»ä¼¼ã€‚æ€»ä½“æ¥è¯´ï¼Œlibev è¦æ¯” redis åŠŸèƒ½ä¸°å¯Œå®ç”¨ï¼Œredis ä¸ç”¨ libevï¼Œå¯èƒ½ redis ä½œè€…å¸Œæœ›æºç æ›´å¯æ§ã€‚</p>

<ul>
  <li>libev å¤„ç†äº‹ä»¶ç±»å‹æ›´ä¸°å¯Œï¼Œ<code class="highlighter-rouge">aeEventLoop</code> åªå¤„ç†äº†æ–‡ä»¶äº‹ä»¶å’Œæ—¶é’Ÿäº‹ä»¶ã€‚</li>
  <li>redis <code class="highlighter-rouge">aeEventLoop</code> æœ‰ <code class="highlighter-rouge">beforesleep</code> å’Œ <code class="highlighter-rouge">aftersleep</code> ç­‰æ“ä½œå¤„ç†ã€‚</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">aeMain</span><span class="p">(</span><span class="n">aeEventLoop</span> <span class="o">*</span><span class="n">eventLoop</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">eventLoop</span><span class="o">-&gt;</span><span class="n">stop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">eventLoop</span><span class="o">-&gt;</span><span class="n">stop</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">eventLoop</span><span class="o">-&gt;</span><span class="n">beforesleep</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
            <span class="n">eventLoop</span><span class="o">-&gt;</span><span class="n">beforesleep</span><span class="p">(</span><span class="n">eventLoop</span><span class="p">);</span>
        <span class="n">aeProcessEvents</span><span class="p">(</span><span class="n">eventLoop</span><span class="p">,</span> <span class="n">AE_ALL_EVENTS</span><span class="o">|</span><span class="n">AE_CALL_AFTER_SLEEP</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>libev å¾ˆå¤šæºç ç»†èŠ‚åšå¾—æ›´å¥½ï¼Œä¾‹å¦‚ï¼š
    <ol>
      <li>æ—¶é’Ÿï¼Œredis ç”¨çš„æ˜¯åˆ—è¡¨å­˜å‚¨ï¼ˆä¸ä¼˜åŒ–çš„åŸå› ï¼Œç›®å‰æ—¶é’Ÿäº‹ä»¶å¹¶ä¸å¤šï¼Œæš‚æ—¶æ²¡æœ‰æ”¹è¿›çš„å¿…è¦ï¼‰ï¼Œè€Œ libev ç”¨æ•°ç»„å­˜å‚¨æ—¶é’Ÿäº‹ä»¶ï¼Œé€šè¿‡å †æ’åºï¼Œè¿‡æœŸç­–ç•¥åšå¾—éå¸¸é«˜æ•ˆã€‚</li>
      <li>ä¾‹å¦‚ epoll_ctl å‡ºç°é‡å¤æ’å…¥äº‹ä»¶é”™è¯¯ï¼ˆEEXISTï¼‰ï¼Œlibev ä¼šä¸»åŠ¨è¿›è¡Œä¿®æ”¹ EPOLL_CTL_MODã€‚è€Œ redis è¿™ç§åœºæ™¯ï¼Œå°±ç›´æ¥è¿”å›é”™è¯¯ï¼Œè®©ç”¨æˆ·å¤„ç†äº†ã€‚</li>
    </ol>
  </li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// libev - ev_epoll.c</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">epoll_modify</span> <span class="p">(</span><span class="n">EV_P_</span> <span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="kt">int</span> <span class="n">oev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nev</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">expect_true</span> <span class="p">(</span><span class="o">!</span><span class="n">epoll_ctl</span> <span class="p">(</span><span class="n">backend_fd</span><span class="p">,</span> <span class="n">oev</span> <span class="o">&amp;&amp;</span> <span class="n">oldmask</span> <span class="o">!=</span> <span class="n">nev</span> <span class="o">?</span> <span class="n">EPOLL_CTL_MOD</span> <span class="o">:</span> <span class="n">EPOLL_CTL_ADD</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ev</span><span class="p">)))</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">...</span>
    <span class="c1">// é”™è¯¯å¤„ç†ã€‚</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">expect_true</span> <span class="p">(</span><span class="n">errno</span> <span class="o">==</span> <span class="n">EEXIST</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="cm">/* EEXIST means we ignored a previous DEL, but the fd is still active */</span>
      <span class="cm">/* if the kernel mask is the same as the new mask, we assume it hasn't changed */</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">oldmask</span> <span class="o">==</span> <span class="n">nev</span><span class="p">)</span>
        <span class="k">goto</span> <span class="n">dec_egen</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">epoll_ctl</span> <span class="p">(</span><span class="n">backend_fd</span><span class="p">,</span> <span class="n">EPOLL_CTL_MOD</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ev</span><span class="p">))</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="c1">// redis - ep_epoll.c</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">aeApiAddEvent</span><span class="p">(</span><span class="n">aeEventLoop</span> <span class="o">*</span><span class="n">eventLoop</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mask</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">aeApiState</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">eventLoop</span><span class="o">-&gt;</span><span class="n">apidata</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">epoll_event</span> <span class="n">ee</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span> <span class="cm">/* avoid valgrind warning */</span>
    <span class="cm">/* If the fd was already monitored for some event, we need a MOD
     * operation. Otherwise we need an ADD operation. */</span>
    <span class="kt">int</span> <span class="n">op</span> <span class="o">=</span> <span class="n">eventLoop</span><span class="o">-&gt;</span><span class="n">events</span><span class="p">[</span><span class="n">fd</span><span class="p">].</span><span class="n">mask</span> <span class="o">==</span> <span class="n">AE_NONE</span> <span class="o">?</span>
            <span class="n">EPOLL_CTL_ADD</span> <span class="o">:</span> <span class="n">EPOLL_CTL_MOD</span><span class="p">;</span>

    <span class="n">ee</span><span class="p">.</span><span class="n">events</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">mask</span> <span class="o">|=</span> <span class="n">eventLoop</span><span class="o">-&gt;</span><span class="n">events</span><span class="p">[</span><span class="n">fd</span><span class="p">].</span><span class="n">mask</span><span class="p">;</span> <span class="cm">/* Merge old events */</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mask</span> <span class="o">&amp;</span> <span class="n">AE_READABLE</span><span class="p">)</span> <span class="n">ee</span><span class="p">.</span><span class="n">events</span> <span class="o">|=</span> <span class="n">EPOLLIN</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mask</span> <span class="o">&amp;</span> <span class="n">AE_WRITABLE</span><span class="p">)</span> <span class="n">ee</span><span class="p">.</span><span class="n">events</span> <span class="o">|=</span> <span class="n">EPOLLOUT</span><span class="p">;</span>
    <span class="n">ee</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">fd</span> <span class="o">=</span> <span class="n">fd</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">epoll_ctl</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">epfd</span><span class="p">,</span><span class="n">op</span><span class="p">,</span><span class="n">fd</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ee</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<h2 id="4-å‚è€ƒ">4. å‚è€ƒ</h2>

<ul>
  <li><a href="http://software.schmorp.de/pkg/libev.html">å®˜ç½‘</a></li>
  <li><a href="http://dist.schmorp.de/libev/">å®˜æ–¹æºç </a></li>
  <li><a href="http://pod.tst.eu/http://cvs.schmorp.de/libev/ev.pod#code_ev_timer_code_relative_and_opti">å®˜æ–¹æ–‡æ¡£</a></li>
  <li><a href="https://my.oschina.net/u/917596/blog/176658">äº‹ä»¶åº“ä¹‹Libevï¼ˆä¸€ï¼‰</a></li>
  <li><a href="https://www.cnblogs.com/gqtcgq/category/1043758.html">éšç¬”åˆ†ç±» - libev</a></li>
  <li><a href="https://wenfh2020.com/2020/04/06/ae-timer/">[redis æºç èµ°è¯»] äº‹ä»¶ - å®šæ—¶å™¨</a></li>
  <li><a href="https://wenfh2020.com/2020/04/09/redis-ae-file/">[redis æºç èµ°è¯»] äº‹ä»¶ - æ–‡ä»¶äº‹ä»¶</a></li>
  <li><a href="http://chenzhenianqing.com/articles/1051.html">Libevè½»ç½‘ç»œåº“ æºç æµ…æ</a></li>
</ul>

<hr />

<blockquote>
  <p>ğŸ”¥æ–‡ç« æ¥æºï¼š<a href="https://wenfh2020.com/2020/05/28/libev-source-reading/">wenfh2020.com</a></p>
</blockquote>
:ET